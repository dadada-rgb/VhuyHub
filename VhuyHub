local rs = game:GetService("RunService")
local uis = game:GetService("UserInputService")
local lp = game.Players.LocalPlayer

-- Danh sách animation (URL đầy đủ)
local animations = {
	C = "http://www.roblox.com/asset/?id=15609995579",
	V = "http://www.roblox.com/asset/?id=15517864808",
	B = "http://www.roblox.com/asset/?id=10714349037",
	N = "http://www.roblox.com/asset/?id=14352343065",
	M = "http://www.roblox.com/asset/?id=14352340648",
        H = "http://www.roblox.com/asset/?id=15392759696",
        J = "http://www.roblox.com/asset/?id=10714061912",
        Z = "http://www.roblox.com/asset/?id=11394033602",
}

local currentTrack = nil
local currentKey = nil
local renderConnection = nil
local inputConnection = nil

local function setup(char)
	local hum = char:WaitForChild("Humanoid", 5)
	if not hum then return end

	local animator = hum:FindFirstChildOfClass("Animator") or Instance.new("Animator", hum)

	-- Ngắt kết nối cũ
	if renderConnection then renderConnection:Disconnect() end
	if inputConnection then inputConnection:Disconnect() end

	-- Dừng animation nếu di chuyển
	renderConnection = rs.RenderStepped:Connect(function()
		if currentTrack and hum.MoveDirection.Magnitude > 0 then
			currentTrack:Stop()
			currentTrack = nil
			currentKey = nil
		end
	end)

	-- Nhấn phím để phát lại animation
	inputConnection = uis.InputBegan:Connect(function(input)
		local key = input.KeyCode.Name
		local animId = animations[key]
		if animId and hum.MoveDirection.Magnitude == 0 then
			-- Dừng animation cũ nếu đang chạy
			if currentTrack then
				currentTrack:Stop()
				currentTrack = nil
				currentKey = nil
			end
			-- Phát animation mới
			local anim = Instance.new("Animation")
			anim.AnimationId = animId
			local track = animator:LoadAnimation(anim)
			track:Play()
			currentTrack = track
			currentKey = key
		end
	end)
end

-- Nếu đã có character
if lp.Character then
	setup(lp.Character)
end

-- Khi respawn
lp.CharacterAdded:Connect(function(char)
	currentTrack = nil
	currentKey = nil
	task.wait(0.2)
	setup(char)
end)

-- Hiện thông báo
local function sendNotification(title, text)
	game:GetService("StarterGui"):SetCore("SendNotification", {
		Title = title,
		Text = text,
		Duration = 3
	})
end

local TweenService = game:GetService("TweenService")

-- Tạo hiệu ứng mờ nền
local blur = Instance.new("BlurEffect")
blur.Size = 20
blur.Parent = game.Lighting

-- Tạo GUI
local gui = Instance.new("ScreenGui")
gui.Name = "VhuyIntroGui"
gui.IgnoreGuiInset = true
gui.ResetOnSpawn = false
gui.DisplayOrder = 99999
gui.Parent = game:GetService("CoreGui")

-- Nền đen mờ
local bg = Instance.new("Frame")
bg.Size = UDim2.new(1, 0, 1, 0)
bg.BackgroundColor3 = Color3.new(0, 0, 0)
bg.BackgroundTransparency = 1 -- bắt đầu ẩn
bg.Parent = gui

-- Dòng chữ chính
local title = Instance.new("TextLabel")
title.AnchorPoint = Vector2.new(0.5, 0.5)
title.Position = UDim2.new(0.5, 0, 0.5, 0)
title.Size = UDim2.new(0, 300, 0, 100)
title.Text = "DhuyxDtuyen"
title.Font = Enum.Font.GothamBlack
title.TextColor3 = Color3.fromRGB(255, 179, 186)
title.TextScaled = true
title.TextTransparency = 1 -- bắt đầu mờ hoàn toàn
title.BackgroundTransparency = 1
title.Parent = gui

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 12)
corner.Parent = title

-- Hiệu ứng fade in
TweenService:Create(title, TweenInfo.new(1), {TextTransparency = 0}):Play()
TweenService:Create(bg, TweenInfo.new(1), {BackgroundTransparency = 0.5}):Play()

-- Giữ 3 giây rồi fade out
task.delay(4, function()
	TweenService:Create(title, TweenInfo.new(1), {TextTransparency = 1}):Play()
	TweenService:Create(bg, TweenInfo.new(1), {BackgroundTransparency = 1}):Play()

	task.delay(1, function()
		gui:Destroy()
		blur:Destroy()
	end)
end)

-- Button GUI để phát animation C
local player = game.Players.LocalPlayer
local mouse = player:GetMouse()

-- Tạo GUI cho nút
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "CButtonGui"
screenGui.ResetOnSpawn = false
screenGui.IgnoreGuiInset = true
screenGui.Parent = game.CoreGui

-- Nút chính
local button = Instance.new("TextButton")
button.Name = "PlayCButton"
button.Size = UDim2.new(0, 40, 0, 40)
button.Position = UDim2.new(0, 10, 0, 300) -- vị trí ban đầu
button.BackgroundColor3 = Color3.fromRGB(255, 179, 186)
button.Text = "C"
button.TextColor3 = Color3.new(0, 0, 0)
button.TextScaled = true
button.AutoButtonColor = true
button.Parent = screenGui

-- Bo góc
local uiCorner = Instance.new("UICorner")
uiCorner.CornerRadius = UDim.new(1, 0)
uiCorner.Parent = button

local dragging = false
local dragStart, startPos

local function update(input)
	local delta = input.Position - dragStart
	button.Position = UDim2.new(
		startPos.X.Scale, startPos.X.Offset + delta.X,
		startPos.Y.Scale, startPos.Y.Offset + delta.Y
	)
end

button.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
		dragging = true
		dragStart = input.Position
		startPos = button.Position

		input.Changed:Connect(function()
			if input.UserInputState == Enum.UserInputState.End then
				dragging = false
			end
		end)
	end
end)

game:GetService("UserInputService").InputChanged:Connect(function(input)
	if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
		update(input)
	end
end)

-- Khi bấm nút thì phát animation "C"
button.MouseButton1Click:Connect(function()
	local char = player.Character
	if not char then return end
	local hum = char:FindFirstChildOfClass("Humanoid")
	if not hum then return end
	if hum.MoveDirection.Magnitude > 0 then return end

	local animator = hum:FindFirstChildOfClass("Animator") or Instance.new("Animator", hum)
	local anim = Instance.new("Animation")
	anim.AnimationId = "http://www.roblox.com/asset/?id=15609995579" -- Animation C
	local track = animator:LoadAnimation(anim)

	-- Dừng animation hiện tại nếu có
	if currentTrack then
		currentTrack:Stop()
	end

	track:Play()
	currentTrack = track
	currentKey = "C"
end)

local function loadZombieAnimations(character)
    local humanoid = character:WaitForChild("Humanoid", 5)
    local animateScript = character:WaitForChild("Animate", 5)
    if not humanoid or not animateScript then return end

    local animator = humanoid:FindFirstChildOfClass("Animator") or Instance.new("Animator", humanoid)

    -- Danh sách animation zombie R15
    local zombieAnims = {
        idle = "rbxassetid://6161589290",
        walk = "rbxassetid://6161561193",
        run = "rbxassetid://6161636826",
        jump = "rbxassetid://6161619978",
        fall = "rbxassetid://6161574767",
        climb = "rbxassetid://6161553182",
        swim = "rbxassetid://6161651097",
        swimidle = "rbxassetid://6161651097",
    }

    -- Hàm thay thế animation
    local function replaceAnimation(animName, animId)
        local animFolder = animateScript:FindFirstChild(animName)
        if animFolder and animFolder:FindFirstChild("Animation") then
            animFolder.Animation.AnimationId = animId
        else
            -- Tạo mới nếu không tồn tại
            local newAnim = Instance.new("Animation")
            newAnim.Name = "Animation"
            newAnim.AnimationId = animId
            local folder = Instance.new("Folder")
            folder.Name = animName
            newAnim.Parent = folder
            folder.Parent = animateScript
        end
    end

    -- Thay thế toàn bộ animation
    for animName, animId in pairs(zombieAnims) do
        replaceAnimation(animName, animId)
    end

    -- Đảm bảo reload animation
    humanoid:ChangeState(Enum.HumanoidStateType.Physics)
    task.wait(0.05)
    humanoid:ChangeState(Enum.HumanoidStateType.GettingUp)

    -- Phát animation trên server để đồng bộ
    local function playAnimation(animId)
        local anim = Instance.new("Animation")
        anim.AnimationId = animId
        local track = animator:LoadAnimation(anim)
        track:Play()
        return track
    end

    -- Kiểm tra trạng thái nhân vật để áp dụng animation phù hợp
    humanoid.StateChanged:Connect(function(oldState, newState)
        if newState == Enum.HumanoidStateType.Running and humanoid.MoveDirection.Magnitude > 0 then
            playAnimation(zombieAnims.run)
        elseif newState == Enum.HumanoidStateType.Jumping then
            playAnimation(zombieAnims.jump)
        elseif newState == Enum.HumanoidStateType.Freefall then
            playAnimation(zombieAnims.fall)
        elseif newState == Enum.HumanoidStateType.Climbing then
            playAnimation(zombieAnims.climb)
        elseif newState == Enum.HumanoidStateType.Swimming then
            playAnimation(zombieAnims.swim)
        elseif newState == Enum.HumanoidStateType.Landed then
            playAnimation(zombieAnims.idle)
        end
    end)
end

-- Áp dụng khi nhân vật spawn
game.Players.LocalPlayer.CharacterAdded:Connect(function(char)
    task.wait(0.1) -- Đợi nhân vật load hoàn tất
    loadZombieAnimations(char)
end)

-- Áp dụng nếu nhân vật đã tồn tại
if game.Players.LocalPlayer.Character then
    loadZombieAnimations(game.Players.LocalPlayer.Character)
end

-- Load script theo PlaceId
local placeId = game.PlaceId
local scriptUrls = {
	[9872472334] = "https://raw.githubusercontent.com/dadada-rgb/VhuyHub/refs/heads/main/evade",
	[10662542523] = "https://raw.githubusercontent.com/dadada-rgb/VhuyHub/refs/heads/main/evade",
	[10324347967] = "https://raw.githubusercontent.com/dadada-rgb/VhuyHub/refs/heads/main/evade",
	[10324346056] = "https://raw.githubusercontent.com/dadada-rgb/VhuyHub/refs/heads/main/evade",
	[10530697691] = "https://raw.githubusercontent.com/dadada-rgb/VhuyHub/refs/heads/main/evade",
	[10808838353] = "https://raw.githubusercontent.com/dadada-rgb/VhuyHub/refs/heads/main/evade",
	[142823291] = "https://raw.githubusercontent.com/dadada-rgb/VhuyHub/refs/heads/main/mm2",
	[13772394625] = "https://raw.githubusercontent.com/dadada-rgb/VhuyHub/refs/heads/main/Bladeball",
        [6839171747] = "https://raw.githubusercontent.com/DarkDoorsKing/Project/main/Doors.lua",
}

local url = scriptUrls[placeId] or "https://raw.githubusercontent.com/dadada-rgb/VhuyHub/refs/heads/main/hood"
loadstring(game:HttpGet(url))()
sendNotification("Script Loaded", "Đã load DhuyXDtuyen")

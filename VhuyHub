-- XÓA GUI & NGẮT KẾT NỐI CŨ TRƯỚC KHI CHẠY LẠI
pcall(function()
    local pg = game.Players.LocalPlayer:FindFirstChild("PlayerGui")
    if pg then
        for _, gui in ipairs(pg:GetChildren()) do
            if gui.Name == "DhuyxMenu" or gui.Name == "VhuyIntroGui" or gui.Name == "CButtonGui" or gui.Name == "SafeESP" then
                gui:Destroy()
            end
        end
    end

    local bp = game.Players.LocalPlayer:FindFirstChild("Backpack")
    if bp then
        local tool = bp:FindFirstChild("ClickTP")
        if tool then tool:Destroy() end
    end

    if getgenv().noclipConnection and typeof(getgenv().noclipConnection) == "RBXScriptConnection" then
        getgenv().noclipConnection:Disconnect()
        getgenv().noclipConnection = nil
    end

    getgenv().hiddenFling = false

    if getgenv().ESPs then
        for _, esp in pairs(getgenv().ESPs) do
            pcall(function()
                if esp.label then esp.label:Destroy() end
                if esp.highlight then esp.highlight:Destroy() end
            end)
        end
        getgenv().ESPs = {}
    end

    if getgenv().Connections then
        for _, conn in pairs(getgenv().Connections) do
            pcall(function() conn:Disconnect() end)
        end
        getgenv().Connections = {}
    end
end)

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Workspace = game:GetService("Workspace")
local TweenService = game:GetService("TweenService")
local Lighting = game:GetService("Lighting")
local LocalPlayer = Players.LocalPlayer
local Camera = Workspace.CurrentCamera
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")
local HttpService = game:GetService("HttpService")

-- Tạo file config riêng cho mỗi người chơi
local ConfigFile = "mygui_config_" .. LocalPlayer.UserId .. ".json"

-- Cấu trúc config mặc định
local Config = {
    Buttons = {},
    GuiPosition = {X = 0, Y = 0},
    GuiVisible = true,
    ESPEnabled = false,
    SpeedEnabled = false,
    FlyEnabled = false,
    AimlockEnabled = false,
    FullbrightEnabled = false,
    NoclipEnabled = false,
    ShiftAmount = 0.5,
    SelectedPlayers = {},
    FlySpeed = 35,
    SpeedAmount = 20,
    infiniteJumpEnabled = false,
    clickTpEnabled = false,
    checkKOAimlock = false,
    CustomPing = nil,
    Keybinds = {},
    AntiLockEnabled = false,
    AntiLockType = "Behind",
    LookAtEnabled = false,
    CSyncEnabled = false,
    CSyncType = "Orbit",
    CSyncDistance = 10,
    CSyncHeight = 2,
    CSyncSpeed = 10,
    CSyncRandomAmount = 10,
    BulletTPEnabled = false
}

-- Hàm lưu config
local function SaveSettings()
    local success, err = pcall(function()
        writefile(ConfigFile, HttpService:JSONEncode(Config))
    end)
    if not success then
        warn("[SaveSettings] Lỗi lưu config:", err)
    end
end

-- Hàm load config
local function LoadSettings()
    if isfile(ConfigFile) then
        local success, data = pcall(function()
            return HttpService:JSONDecode(readfile(ConfigFile))
        end)
        if success and type(data) == "table" then
            for k, v in pairs(data) do
                Config[k] = v
            end
        else
            warn("[LoadSettings] Lỗi đọc config:", data)
        end
    else
        SaveSettings()
    end
end

LoadSettings()

-- Biến toàn cục
getgenv().Desync = Config.AntiLockEnabled
getgenv().AntiLockType = Config.AntiLockType
getgenv().Direction = Vector3.new(0, 0, -1)
getgenv().Sentinel = { LookAt = Config.LookAtEnabled }
getgenv().BulletTP = { Enabled = Config.BulletTPEnabled }
local MacroAlreadLoaded = false
local TargetAimbot = {
    CSync = {
        Enabled = Config.CSyncEnabled,
        Type = Config.CSyncType,
        Distance = Config.CSyncDistance,
        Height = Config.CSyncHeight,
        Speed = Config.CSyncSpeed,
        RandomAmount = Config.CSyncRandomAmount,
        Color = Color3.fromRGB(255, 255, 255)
    }
}
local Client = LocalPlayer
local Saved = nil
local MCenabled = false

-- Biến lưu trạng thái Lighting cũ cho Fullbright
local oldLighting = {
    Brightness = Lighting.Brightness,
    GlobalShadows = Lighting.GlobalShadows,
    FogEnd = Lighting.FogEnd,
    Ambient = Lighting.Ambient,
    OutdoorAmbient = Lighting.OutdoorAmbient,
    ClockTime = Lighting.ClockTime
}

-- Danh sách animation
local animations = {
    C = "http://www.roblox.com/asset/?id=15609995579",
    N = "http://www.roblox.com/asset/?id=14352343065"
}

local currentTrack = nil
local currentKey = nil
local renderConnection = nil
local inputConnection = nil
local clickTpTool = nil
local savedWaypoint = nil
local noclipConnection = nil

-- Hàm gửi thông báo
local function sendNotification(title, text, duration)
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = title,
        Text = text,
        Duration = duration or 3
    })
end

-- Hàm kiểm tra người chơi hợp lệ (không bị K.O)
local function IsValidTarget(player)
    if player and player.Character and player.Character:FindFirstChild("Humanoid") and player.Character:FindFirstChild("HumanoidRootPart") then
        local bodyEffects = player.Character:FindFirstChild("BodyEffects")
        local koValue = bodyEffects and bodyEffects:FindFirstChild("K.O")
        return player.Character.Humanoid.Health > 0 and (not koValue or not koValue.Value)
    end
    return false
end

-- Hàm tìm người chơi gần nhất trong danh sách
local function FindClosestSelectedPlayer()
    local closestPlayer, minDist = nil, math.huge
    local myPos = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") and LocalPlayer.Character.HumanoidRootPart.Position
    if not myPos then return nil end

    for name, selected in pairs(Config.SelectedPlayers) do
        if selected then
            local plr = Players:FindFirstChild(name)
            if plr and IsValidTarget(plr) then
                local pos = plr.Character.HumanoidRootPart.Position
                local dist = (myPos - pos).Magnitude
                if dist < minDist then
                    closestPlayer = plr
                    minDist = dist
                end
            end
        end
    end
    return closestPlayer
end

-- Hàm thiết lập nhân vật
local function setupCharacter(char)
    local hum = char:WaitForChild("Humanoid", 5)
    if not hum then return end

    local animator = hum:FindFirstChildOfClass("Animator") or Instance.new("Animator", hum)

    if renderConnection then renderConnection:Disconnect() end
    if inputConnection then inputConnection:Disconnect() end

    renderConnection = RunService.RenderStepped:Connect(function()
        if currentTrack and hum.MoveDirection.Magnitude > 0 then
            currentTrack:Stop()
            currentTrack = nil
            currentKey = nil
        end
    end)

    inputConnection = UserInputService.InputBegan:Connect(function(input)
        local key = input.KeyCode.Name
        local animId = animations[key]
        if animId and hum.MoveDirection.Magnitude == 0 then
            if currentTrack then
                currentTrack:Stop()
                currentTrack = nil
                currentKey = nil
            end
            local anim = Instance.new("Animation")
            anim.AnimationId = animId
            local track = animator:LoadAnimation(anim)
            track:Play()
            currentTrack = track
            currentKey = key
        end
    end)
end

if LocalPlayer.Character then
    setupCharacter(LocalPlayer.Character)
end

LocalPlayer.CharacterAdded:Connect(function(char)
    currentTrack = nil
    currentKey = nil
    task.wait(0.2)
    setupCharacter(char)
end)

-- Logic Fly
local function UpdateFly()
    local char = LocalPlayer.Character
    if not char or not char:FindFirstChild("HumanoidRootPart") or not char:FindFirstChildOfClass("Humanoid") then
        return
    end

    local root = char.HumanoidRootPart
    local hum = char:FindFirstChildOfClass("Humanoid")
    local bodyVelocity = char:FindFirstChild("BodyVelocity") or Instance.new("BodyVelocity")
    bodyVelocity.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
    bodyVelocity.Velocity = Vector3.new(0, 0, 0)
    bodyVelocity.Parent = root

    local bodyGyro = char:FindFirstChild("BodyGyro") or Instance.new("BodyGyro")
    bodyGyro.MaxTorque = Vector3.new(math.huge, math.huge, math.huge)
    bodyGyro.P = 10000
    bodyGyro.D = 1000
    bodyGyro.Parent = root

    local cam = Camera.CFrame
    local moveDirection = Vector3.new(0, 0, 0)

    if UserInputService:IsKeyDown(Enum.KeyCode.W) then
        moveDirection = moveDirection + cam.LookVector
    end
    if UserInputService:IsKeyDown(Enum.KeyCode.S) then
        moveDirection = moveDirection - cam.LookVector
    end
    if UserInputService:IsKeyDown(Enum.KeyCode.D) then
        moveDirection = moveDirection + cam.RightVector
    end
    if UserInputService:IsKeyDown(Enum.KeyCode.A) then
        moveDirection = moveDirection - cam.RightVector
    end
    if UserInputService:IsKeyDown(Enum.KeyCode.Space) then
        moveDirection = moveDirection + Vector3.new(0, 1, 0)
    end
    if UserInputService:IsKeyDown(Enum.KeyCode.LeftControl) then
        moveDirection = moveDirection - Vector3.new(0, 1, 0)
    end

    if moveDirection.Magnitude > 0 then
        moveDirection = moveDirection.Unit * Config.FlySpeed
    end

    bodyVelocity.Velocity = moveDirection
    bodyGyro.CFrame = cam

    if not Config.FlyEnabled then
        bodyVelocity:Destroy()
        bodyGyro:Destroy()
    end
end

-- Logic Speed
local function UpdateSpeed()
    local char = LocalPlayer.Character
    if not char or not char:FindFirstChildOfClass("Humanoid") then
        return
    end
    local hum = char:FindFirstChildOfClass("Humanoid")
    hum.WalkSpeed = Config.SpeedEnabled and Config.SpeedAmount or 16
end

-- Logic ESP
local function CreateESP(player)
    if player == LocalPlayer or not Config.ESPEnabled then return end
    if not player.Character or not player.Character:FindFirstChild("Head") then return end

    local highlight = Instance.new("Highlight")
    highlight.FillColor = Color3.fromRGB(255, 0, 0)
    highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
    highlight.Parent = player.Character
    highlight.Adornee = player.Character

    local billboard = Instance.new("BillboardGui")
    billboard.Name = "ESP"
    billboard.Size = UDim2.new(0, 100, 0, 50)
    billboard.StudsOffset = Vector3.new(0, 3, 0)
    billboard.AlwaysOnTop = true
    billboard.Parent = player.Character.Head

    local nameLabel = Instance.new("TextLabel")
    nameLabel.Size = UDim2.new(1, 0, 0.5, 0)
    nameLabel.BackgroundTransparency = 1
    nameLabel.Text = player.Name
    nameLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    nameLabel.TextSize = 14
    nameLabel.Font = Enum.Font.GothamBold
    nameLabel.Parent = billboard

    local healthLabel = Instance.new("TextLabel")
    healthLabel.Size = UDim2.new(1, 0, 0.5, 0)
    healthLabel.Position = UDim2.new(0, 0, 0.5, 0)
    healthLabel.BackgroundTransparency = 1
    healthLabel.Text = "Health: 100"
    healthLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    healthLabel.TextSize = 14
    healthLabel.Font = Enum.Font.Gotham
    healthLabel.Parent = billboard

    getgenv().ESPs[player.Name] = {highlight = highlight, label = billboard}

    local connection
    connection = RunService.RenderStepped:Connect(function()
        if not Config.ESPEnabled or not player.Character or not player.Character:FindFirstChild("Humanoid") then
            highlight:Destroy()
            billboard:Destroy()
            if getgenv().ESPs[player.Name] then
                getgenv().ESPs[player.Name] = nil
            end
            connection:Disconnect()
            return
        end
        healthLabel.Text = "Health: " .. math.floor(player.Character.Humanoid.Health)
    end)

    table.insert(getgenv().Connections, connection)
end

-- Logic Aimlock
local function Aimlock()
    if not Config.AimlockEnabled then return end
    local target = FindClosestSelectedPlayer()
    if not target or (Config.checkKOAimlock and not IsValidTarget(target)) then return end

    local myRoot = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
    if not myRoot then return end

    local targetRoot = target.Character:FindFirstChild("HumanoidRootPart")
    if not targetRoot then return end

    Camera.CFrame = CFrame.new(Camera.CFrame.Position, targetRoot.Position)
end

-- Cập nhật ESP cho người chơi
getgenv().ESPs = getgenv().ESPs or {}
getgenv().Connections = getgenv().Connections or {}

for _, player in ipairs(Players:GetPlayers()) do
    if player ~= LocalPlayer then
        CreateESP(player)
    end
end

Players.PlayerAdded:Connect(function(player)
    if player ~= LocalPlayer then
        CreateESP(player)
    end
end)

-- Logic AntiLock
RunService.Heartbeat:Connect(function()
    if getgenv().Desync then
        local abc = LocalPlayer.Character and LocalPlayer.Character.HumanoidRootPart and LocalPlayer.Character.HumanoidRootPart.Velocity
        if not abc then return end
        if getgenv().AntiLockType == "Behind" then getgenv().Direction = Vector3.new(0, 0, -1)
        elseif getgenv().AntiLockType == "Down" then getgenv().Direction = Vector3.new(0, -1, 0)
        elseif getgenv().AntiLockType == "ForWard" then getgenv().Direction = Vector3.new(0, 0, 1)
        elseif getgenv().AntiLockType == "Left" then getgenv().Direction = Vector3.new(-1, 0, 0)
        elseif getgenv().AntiLockType == "One" then getgenv().Direction = Vector3.new(1, 1, 1)
        elseif getgenv().AntiLockType == "Right" then getgenv().Direction = Vector3.new(1, 0, 0)
        elseif getgenv().AntiLockType == "Up" then getgenv().Direction = Vector3.new(0, 1, 0)
        elseif getgenv().AntiLockType == "Zero" then getgenv().Direction = Vector3.new(0, 0, 0)
        end
        LocalPlayer.Character.HumanoidRootPart.Velocity = getgenv().Direction * (2^16)
        RunService.RenderStepped:Wait()
        LocalPlayer.Character.HumanoidRootPart.Velocity = abc
    end
end)

-- Logic C-Sync
local desync_setback = Instance.new("Part")
desync_setback.Anchored = true
desync_setback.Transparency = 1
desync_setback.Size = Vector3.new(0.2, 0.2, 0.2)
desync_setback.Parent = Workspace

RunService.Heartbeat:Connect(function()
    if TargetAimbot.CSync.Enabled then
        local TargetPlr = FindClosestSelectedPlayer()
        if TargetPlr then
            local FakeCFrame = Client.Character.HumanoidRootPart.CFrame
            Saved = Client.Character.HumanoidRootPart.CFrame
            if TargetAimbot.CSync.Type == "Random" then
                FakeCFrame = CFrame.new(TargetPlr.Character.HumanoidRootPart.Position + Vector3.new(
                    math.random(-TargetAimbot.CSync.RandomAmount, TargetAimbot.CSync.RandomAmount),
                    math.random(0, TargetAimbot.CSync.RandomAmount),
                    math.random(-TargetAimbot.CSync.RandomAmount, TargetAimbot.CSync.RandomAmount)
                )) * CFrame.Angles(math.rad(math.random(0, 360)), math.rad(math.random(0, 360)), math.rad(math.random(0, 360)))
            elseif TargetAimbot.CSync.Type == "Orbit" then
                local CurrentTime = tick()
                FakeCFrame = CFrame.new(TargetPlr.Character.HumanoidRootPart.Position) * 
                             CFrame.Angles(0, 2 * math.pi * CurrentTime * TargetAimbot.CSync.Speed % (2 * math.pi), 0) * 
                             CFrame.new(0, TargetAimbot.CSync.Height, TargetAimbot.CSync.Distance)
            end
            Client.Character.HumanoidRootPart.CFrame = FakeCFrame
            RunService.RenderStepped:Wait()
            desync_setback.Position = Saved.Position + Vector3.new(0, 1.5, 0)
            Camera.CameraSubject = desync_setback
            Client.Character.HumanoidRootPart.CFrame = Saved
        else
            Camera.CameraSubject = LocalPlayer.Character.Humanoid
        end
    else
        Camera.CameraSubject = LocalPlayer.Character.Humanoid
    end
end)

-- Logic Look At
local function LookAtPlayer()
    local TargetPlr = FindClosestSelectedPlayer()
    local localChar = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
    local localHumanoidRootPart = localChar:FindFirstChild("HumanoidRootPart")

    if localHumanoidRootPart then
        if getgenv().Sentinel.LookAt and not MCenabled and TargetPlr then
            local targetHumanoidRootPart = TargetPlr.Character.HumanoidRootPart
            local targetPosition = targetHumanoidRootPart.Position
            local localPosition = localHumanoidRootPart.Position
            local horizontalDirection = Vector3.new(targetPosition.X - localPosition.X, 0, targetPosition.Z - localPosition.Z).unit
            localHumanoidRootPart.CFrame = CFrame.new(localPosition, localPosition + horizontalDirection)
            localChar.Humanoid.AutoRotate = false
        else
            localChar.Humanoid.AutoRotate = true
        end
    end
end

RunService.Stepped:Connect(function()
    if Config.FlyEnabled then UpdateFly() end
    if Config.SpeedEnabled then UpdateSpeed() end
    if Config.AimlockEnabled then Aimlock() end
    LookAtPlayer()
end)

-- Logic Macro
local function LoadMacro()
    if MacroAlreadLoaded then
        sendNotification("Macro", "Macro đã được load!")
        return
    end
    MacroAlreadLoaded = true
    
    local players = game:GetService("Players")
    local runservice = game:GetService("RunService")
    local player = players.LocalPlayer
    local character = player.Character or player.CharacterAdded:Wait()
    local root = character:WaitForChild("HumanoidRootPart")
    local humanoid = character:WaitForChild("Humanoid")
    local camera = workspace.CurrentCamera
    local MAX_LENGTH = 900000
    local active = false
    local ENABLED_OFFSET = CFrame.new(0, 0, 0)
    local DISABLED_OFFSET = CFrame.new(0, 0, 0)
    local rootPos = Vector3.new(0, 0, 0)

    local macroConnection
    macroConnection = RunService.RenderStepped:Connect(function()
        if active and character and root and humanoid then
            root.CFrame = CFrame.new(rootPos) * ENABLED_OFFSET
            camera.CameraType = Enum.CameraType.Scriptable
            camera.CFrame = CFrame.new(root.Position + Vector3.new(0, 5, 10), root.Position)
        else
            camera.CameraType = Enum.CameraType.Custom
        end
    end)

    player.CharacterAdded:Connect(function(newChar)
        character = newChar
        root = character:WaitForChild("HumanoidRootPart")
        humanoid = character:WaitForChild("Humanoid")
    end)

    UserInputService.InputBegan:Connect(function(input, processed)
        if not processed and input.KeyCode == Enum.KeyCode.Q then
            active = not active
            rootPos = root.Position
            camera.CameraType = active and Enum.CameraType.Scriptable or Enum.CameraType.Custom
            camera.CameraSubject = humanoid
            sendNotification("Macro", active and "Macro Enabled" or "Macro Disabled")
        end
    end)
end

-- Logic Bullet TP
RunService.Stepped:Connect(function()
    if getgenv().BulletTP.Enabled then
        local target = FindClosestSelectedPlayer()
        if target and target.Character and target.Character:FindFirstChild("HumanoidRootPart") then
            for _, v in ipairs(Workspace:WaitForChild("Ignored"):GetChildren()) do
                if v.Name == "Bullet" or v.Name == "RPG Rocket" then
                    local bulletPos = v.Position
                    local targetPos = target.Character.HumanoidRootPart.Position
                    v.Position = targetPos + Vector3.new(0, 2, 0) -- Đặt đạn ngay trên đầu target
                end
            end
        end
    end
end)

-- Tạo hiệu ứng mờ nền
local blur = Instance.new("BlurEffect")
blur.Size = 20
blur.Parent = Lighting

-- Tạo GUI intro
local introGui = Instance.new("ScreenGui")
introGui.Name = "VhuyIntroGui"
introGui.IgnoreGuiInset = true
introGui.ResetOnSpawn = false
introGui.DisplayOrder = 99999
introGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

local bg = Instance.new("Frame")
bg.Size = UDim2.new(1, 0, 1, 0)
bg.BackgroundColor3 = Color3.new(0, 0, 0)
bg.BackgroundTransparency = 1
bg.Parent = introGui

local title = Instance.new("TextLabel")
title.AnchorPoint = Vector2.new(0.5, 0.5)
title.Position = UDim2.new(0.5, 0, 0.5, 0)
title.Size = UDim2.new(0, 400, 0, 120)
title.Text = "DhuyxDtuyen"
title.Font = Enum.Font.GothamBlack
title.TextColor3 = Color3.fromRGB(255, 179, 186)
title.TextScaled = true
title.TextTransparency = 1
title.BackgroundTransparency = 1
title.Parent = introGui

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 12)
corner.Parent = title

local gradient = Instance.new("UIGradient")
gradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 179, 186)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(255, 100, 100))
}
gradient.Rotation = 45
gradient.Parent = title

TweenService:Create(title, TweenInfo.new(1.5, Enum.EasingStyle.Sine, Enum.EasingDirection.In), {TextTransparency = 0}):Play()
TweenService:Create(bg, TweenInfo.new(1.5, Enum.EasingStyle.Sine, Enum.EasingDirection.In), {BackgroundTransparency = 0.4}):Play()

task.delay(4, function()
    TweenService:Create(title, TweenInfo.new(1.5, Enum.EasingStyle.Sine, Enum.EasingDirection.Out), {TextTransparency = 1}):Play()
    TweenService:Create(bg, TweenInfo.new(1.5, Enum.EasingStyle.Sine, Enum.EasingDirection.Out), {BackgroundTransparency = 1}):Play()
    task.delay(1.5, function()
        introGui:Destroy()
        blur:Destroy()
    end)
end)

-- Tạo GUI nút C
local cButtonGui = Instance.new("ScreenGui")
cButtonGui.Name = "CButtonGui"
cButtonGui.ResetOnSpawn = false
cButtonGui.IgnoreGuiInset = true
cButtonGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

local cButton = Instance.new("TextButton")
cButton.Name = "PlayCButton"
cButton.Size = UDim2.new(0, 50, 0, 50)
cButton.Position = UDim2.new(0, 20, 0, 300)
cButton.BackgroundColor3 = Color3.fromRGB(255, 179, 186)
cButton.Text = "C"
cButton.TextColor3 = Color3.new(0, 0, 0)
cButton.TextScaled = true
cButton.AutoButtonColor = true
cButton.Parent = cButtonGui

local cCorner = Instance.new("UICorner")
cCorner.CornerRadius = UDim.new(0.5, 0)
cCorner.Parent = cButton

local cGradient = Instance.new("UIGradient")
cGradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 179, 186)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(255, 100, 100))
}
cGradient.Rotation = 90
cGradient.Parent = cButton

local function animateCButton()
    cButton.MouseEnter:Connect(function()
        TweenService:Create(cButton, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(255, 200, 200)}):Play()
    end)
    cButton.MouseLeave:Connect(function()
        TweenService:Create(cButton, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(255, 179, 186)}):Play()
    end)
end
animateCButton()

local dragging = false
local dragStart, startPos

local function updateCButton(input)
    local delta = input.Position - dragStart
    cButton.Position = UDim2.new(
        startPos.X.Scale, startPos.X.Offset + delta.X,
        startPos.Y.Scale, startPos.Y.Offset + delta.Y
    )
end

cButton.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = cButton.Position
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
        updateCButton(input)
    end
end)

cButton.MouseButton1Click:Connect(function()
    local char = LocalPlayer.Character
    if not char then return end
    local hum = char:FindFirstChildOfClass("Humanoid")
    if not hum or hum.MoveDirection.Magnitude > 0 then return end

    local animator = hum:FindFirstChildOfClass("Animator") or Instance.new("Animator", hum)
    local anim = Instance.new("Animation")
    anim.AnimationId = animations["C"]
    local track = animator:LoadAnimation(anim)

    if currentTrack then
        currentTrack:Stop()
    end

    track:Play()
    currentTrack = track
    currentKey = "C"
    sendNotification("Animation", "Playing C animation!")
end)

-- GUI chính
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "DhuyxMenu"
ScreenGui.ResetOnSpawn = false
ScreenGui.IgnoreGuiInset = true
ScreenGui.Parent = PlayerGui

local MenuFrame = Instance.new("Frame")
MenuFrame.Size = UDim2.new(0, 300, 0, 250)
MenuFrame.Position = UDim2.new(0.05, 0, 0.2, 0)
MenuFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
MenuFrame.BackgroundTransparency = 0.1
MenuFrame.Active = true
MenuFrame.Draggable = true
MenuFrame.Parent = ScreenGui
Instance.new("UICorner", MenuFrame).CornerRadius = UDim.new(0, 12)

local gradient = Instance.new("UIGradient")
gradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 179, 186)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(100, 100, 255))
}
gradient.Rotation = 45
gradient.Parent = MenuFrame

local stroke = Instance.new("UIStroke")
stroke.Thickness = 2
stroke.Color = Color3.fromRGB(255, 255, 255)
stroke.Transparency = 0.3
stroke.Parent = MenuFrame

-- Nút Toggle Show/Hide
local ToggleButton = Instance.new("TextButton")
ToggleButton.Size = UDim2.new(0, 70, 0, 30)
ToggleButton.Position = UDim2.new(0, 20, 0, 240)
ToggleButton.BackgroundColor3 = Color3.fromRGB(255, 179, 186)
ToggleButton.Text = "SHOW"
ToggleButton.TextColor3 = Color3.new(0, 0, 0)
ToggleButton.Font = Enum.Font.GothamBold
ToggleButton.TextSize = 16
ToggleButton.Active = true
ToggleButton.Draggable = true
ToggleButton.Parent = ScreenGui
Instance.new("UICorner", ToggleButton).CornerRadius = UDim.new(0, 10)

local toggleGradient = Instance.new("UIGradient")
toggleGradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 179, 186)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(255, 100, 100))
}
toggleGradient.Parent = ToggleButton

local function animateButton(btn)
    btn.MouseEnter:Connect(function()
        TweenService:Create(btn, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(255, 200, 200)}):Play()
    end)
    btn.MouseLeave:Connect(function()
        TweenService:Create(btn, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(255, 179, 186)}):Play()
    end)
    btn.MouseButton1Click:Connect(function()
        TweenService:Create(btn, TweenInfo.new(0.1), {Size = btn.Size + UDim2.new(0, 5, 0, 5)}):Play()
        task.wait(0.1)
        TweenService:Create(btn, TweenInfo.new(0.1), {Size = btn.Size - UDim2.new(0, 5, 0, 5)}):Play()
    end)
end
animateButton(ToggleButton)

ToggleButton.MouseButton1Click:Connect(function()
    local targetSize = MenuFrame.Visible and UDim2.new(0, 0, 0, 0) or UDim2.new(0, 300, 0, 250)
    local tween = TweenService:Create(MenuFrame, TweenInfo.new(0.4, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {Size = targetSize})
    if not MenuFrame.Visible then
        MenuFrame.Visible = true
        tween:Play()
    else
        tween:Play()
        tween.Completed:Wait()
        MenuFrame.Visible = false
    end
    ToggleButton.Text = MenuFrame.Visible and "HIDE" or "SHOW"
end)

-- Tiêu đề & Ping/FPS/Clock
local MenuTitle = Instance.new("TextLabel")
MenuTitle.Size = UDim2.new(1, 0, 0, 30)
MenuTitle.BackgroundTransparency = 1
MenuTitle.Text = "DhuyxDtuyen"
MenuTitle.TextColor3 = Color3.fromRGB(255, 179, 186)
MenuTitle.Font = Enum.Font.GothamBlack
MenuTitle.TextSize = 18
MenuTitle.Parent = MenuFrame

local PingClock = Instance.new("TextLabel")
PingClock.Size = UDim2.new(0, 200, 0, 25)
PingClock.Position = UDim2.new(0, 5, 0, -30)
PingClock.BackgroundTransparency = 1
PingClock.TextColor3 = Color3.fromRGB(255, 255, 255)
PingClock.Font = Enum.Font.Gotham
PingClock.TextSize = 14
PingClock.Parent = MenuTitle

task.spawn(function()
    while task.wait(1) do
        local ping = math.floor(game:GetService("Stats").Network.ServerStatsItem["Data Ping"]:GetValue())
        local fps = math.floor(1 / RunService.RenderStepped:Wait())
        local timeStr = os.date("%H:%M")
        PingClock.Text = string.format("Ping: %d ms | FPS: %d | %s", ping, fps, timeStr)
    end
end)

local PingBox = Instance.new("TextBox")
PingBox.Size = UDim2.new(0, 80, 0, 25)
PingBox.Position = UDim2.new(1, -85, 0, 2)
PingBox.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
PingBox.BackgroundTransparency = 0.2
PingBox.TextColor3 = Color3.fromRGB(0, 0, 0)
PingBox.TextSize = 14
PingBox.Font = Enum.Font.Gotham
PingBox.PlaceholderText = "Ping (ms)"
PingBox.Text = ""
PingBox.ClearTextOnFocus = false
PingBox.Parent = MenuTitle
Instance.new("UICorner", PingBox).CornerRadius = UDim.new(0, 6)

PingBox:GetPropertyChangedSignal("Text"):Connect(function()
    local input = tonumber(PingBox.Text)
    if input and input >= 0 then
        Config.CustomPing = math.clamp(input, 10, 1000)
    else
        Config.CustomPing = nil
    end
    SaveSettings()
end)

-- Tạo 3 trang
local currentPage = 1

local Page1 = Instance.new("Frame")
Page1.Size = UDim2.new(1, 0, 1, -70)
Page1.Position = UDim2.new(0, 0, 0, 30)
Page1.BackgroundTransparency = 1
Page1.Parent = MenuFrame

local PlayerListFrame = Instance.new("Frame")
PlayerListFrame.Size = UDim2.new(0.5, -5, 1, -20)
PlayerListFrame.Position = UDim2.new(0, 5, 0, 10)
PlayerListFrame.BackgroundTransparency = 1
PlayerListFrame.Parent = Page1

local PlayerList = Instance.new("ScrollingFrame")
PlayerList.Size = UDim2.new(1, 0, 1, 0)
PlayerList.CanvasSize = UDim2.new(0, 0, 0, 0)
PlayerList.ScrollBarThickness = 4
PlayerList.BackgroundTransparency = 1
PlayerList.Parent = PlayerListFrame

local UIListLayout = Instance.new("UIListLayout")
UIListLayout.SortOrder = Enum.SortOrder.LayoutOrder
UIListLayout.Padding = UDim.new(0, 4)
UIListLayout.Parent = PlayerList
UIListLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
    PlayerList.CanvasSize = UDim2.new(0, 0, 0, UIListLayout.AbsoluteContentSize.Y)
end)

local ButtonFrame1 = Instance.new("ScrollingFrame")
ButtonFrame1.Size = UDim2.new(0.5, -5, 1, -20)
ButtonFrame1.Position = UDim2.new(0.5, 0, 0, 10)
ButtonFrame1.BackgroundTransparency = 1
ButtonFrame1.ScrollBarThickness = 4
ButtonFrame1.CanvasSize = UDim2.new(0, 0, 0, 0)
ButtonFrame1.Parent = Page1

local ButtonLayout1 = Instance.new("UIListLayout")
ButtonLayout1.SortOrder = Enum.SortOrder.LayoutOrder
ButtonLayout1.Padding = UDim.new(0, 8) -- Tăng padding để tránh chồng lấn
ButtonLayout1.Parent = ButtonFrame1
ButtonLayout1:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
    ButtonFrame1.CanvasSize = UDim2.new(0, 0, 0, ButtonLayout1.AbsoluteContentSize.Y)
end)

local Page2 = Instance.new("Frame")
Page2.Size = UDim2.new(1, 0, 1, -70)
Page2.Position = UDim2.new(0, 0, 0, 30)
Page2.BackgroundTransparency = 1
Page2.Visible = false
Page2.Parent = MenuFrame

local ButtonFrame2Left = Instance.new("ScrollingFrame")
ButtonFrame2Left.Size = UDim2.new(0.5, -5, 1, -20)
ButtonFrame2Left.Position = UDim2.new(0, 5, 0, 10)
ButtonFrame2Left.BackgroundTransparency = 1
ButtonFrame2Left.ScrollBarThickness = 4
ButtonFrame2Left.CanvasSize = UDim2.new(0, 0, 0, 0)
ButtonFrame2Left.Parent = Page2

local ButtonLayout2Left = Instance.new("UIListLayout")
ButtonLayout2Left.SortOrder = Enum.SortOrder.LayoutOrder
ButtonLayout2Left.Padding = UDim.new(0, 6)
ButtonLayout2Left.Parent = ButtonFrame2Left
ButtonLayout2Left:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
    ButtonFrame2Left.CanvasSize = UDim2.new(0, 0, 0, ButtonLayout2Left.AbsoluteContentSize.Y)
end)

local ButtonFrame2Right = Instance.new("ScrollingFrame")
ButtonFrame2Right.Size = UDim2.new(0.5, -5, 1, -20)
ButtonFrame2Right.Position = UDim2.new(0.5, 0, 0, 10)
ButtonFrame2Right.BackgroundTransparency = 1
ButtonFrame2Right.ScrollBarThickness = 4
ButtonFrame2Right.CanvasSize = UDim2.new(0, 0, 0, 0)
ButtonFrame2Right.Parent = Page2

local ButtonLayout2Right = Instance.new("UIListLayout")
ButtonLayout2Right.SortOrder = Enum.SortOrder.LayoutOrder
ButtonLayout2Right.Padding = UDim.new(0, 6)
ButtonLayout2Right.Parent = ButtonFrame2Right
ButtonLayout2Right:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
    ButtonFrame2Right.CanvasSize = UDim2.new(0, 0, 0, ButtonLayout2Right.AbsoluteContentSize.Y)
end)

local Page3 = Instance.new("Frame")
Page3.Size = UDim2.new(1, 0, 1, -70)
Page3.Position = UDim2.new(0, 0, 0, 30)
Page3.BackgroundTransparency = 1
Page3.Visible = false
Page3.Parent = MenuFrame

local ScriptHubScroll = Instance.new("ScrollingFrame")
ScriptHubScroll.Size = UDim2.new(1, -10, 1, -50)
ScriptHubScroll.Position = UDim2.new(0, 5, 0, 5)
ScriptHubScroll.BackgroundTransparency = 1
ScriptHubScroll.ScrollBarThickness = 6
ScriptHubScroll.ScrollingDirection = Enum.ScrollingDirection.Y
ScriptHubScroll.CanvasSize = UDim2.new(0, 0, 0, 0)
ScriptHubScroll.Parent = Page3

local ScriptListLayout = Instance.new("UIListLayout")
ScriptListLayout.SortOrder = Enum.SortOrder.LayoutOrder
ScriptListLayout.Padding = UDim.new(0, 6)
ScriptListLayout.FillDirection = Enum.FillDirection.Vertical
ScriptListLayout.Parent = ScriptHubScroll

ScriptListLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
    ScriptHubScroll.CanvasSize = UDim2.new(0, 0, 0, ScriptListLayout.AbsoluteContentSize.Y)
end)

local function CreateScriptItem(name, url)
    local itemFrame = Instance.new("Frame")
    itemFrame.Size = UDim2.new(1, 0, 0, 35)
    itemFrame.BackgroundTransparency = 0.2
    itemFrame.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    itemFrame.Parent = ScriptHubScroll
    Instance.new("UICorner", itemFrame).CornerRadius = UDim.new(0, 6)

    local nameLabel = Instance.new("TextLabel")
    nameLabel.Size = UDim2.new(0.7, 0, 1, 0)
    nameLabel.Position = UDim2.new(0, 5, 0, 0)
    nameLabel.BackgroundTransparency = 1
    nameLabel.Text = name
    nameLabel.TextColor3 = Color3.fromRGB(0, 0, 0)
    nameLabel.TextSize = 16
    nameLabel.Font = Enum.Font.GothamBold
    nameLabel.TextXAlignment = Enum.TextXAlignment.Left
    nameLabel.Parent = itemFrame

    local runBtn = Instance.new("TextButton")
    runBtn.Size = UDim2.new(0.3, -10, 1, -4)
    runBtn.Position = UDim2.new(0.7, 5, 0, 2)
    runBtn.BackgroundColor3 = Color3.fromRGB(100, 200, 100)
    runBtn.Text = "Run"
    runBtn.TextColor3 = Color3.fromRGB(0, 0, 0)
    runBtn.TextSize = 16
    runBtn.Font = Enum.Font.GothamBold
    runBtn.Parent = itemFrame
    Instance.new("UICorner", runBtn).CornerRadius = UDim.new(0, 6)
    animateButton(runBtn)

    runBtn.MouseButton1Click:Connect(function()
        loadstring(game:HttpGet(url))()
    end)

    return itemFrame
end

CreateScriptItem("Evade", "https://raw.githubusercontent.com/dadada-rgb/VhuyHub/refs/heads/main/evade")
CreateScriptItem("Murder Mystery 2", "https://raw.githubusercontent.com/dadada-rgb/VhuyHub/refs/heads/main/mm2")
CreateScriptItem("Blade Ball", "https://raw.githubusercontent.com/dadada-rgb/VhuyHub/refs/heads/main/Bladeball")
CreateScriptItem("Doors", "https://raw.githubusercontent.com/DarkDoorsKing/Project/main/Doors.lua")
CreateScriptItem("Emote", "https://raw.githubusercontent.com/dadada-rgb/VhuyHub/refs/heads/main/emote")

local PageButtons = Instance.new("Frame")
PageButtons.Size = UDim2.new(1, 0, 0, 35)
PageButtons.Position = UDim2.new(0, 0, 1, -35)
PageButtons.BackgroundTransparency = 1
PageButtons.Parent = MenuFrame

local Btn1 = Instance.new("TextButton")
Btn1.Size = UDim2.new(1/3, -2, 1, 0)
Btn1.Position = UDim2.new(0, 0, 0, 0)
Btn1.Text = "Da Hood"
Btn1.BackgroundColor3 = Color3.fromRGB(255, 179, 186)
Btn1.TextColor3 = Color3.fromRGB(0, 0, 0)
Btn1.Font = Enum.Font.GothamBold
Btn1.TextSize = 16
Instance.new("UICorner", Btn1).CornerRadius = UDim.new(0, 6)
Btn1.Parent = PageButtons
animateButton(Btn1)

local Btn2 = Instance.new("TextButton")
Btn2.Size = UDim2.new(1/3, -2, 1, 0)
Btn2.Position = UDim2.new(1/3, 2, 0, 0)
Btn2.Text = "Universal"
Btn2.BackgroundColor3 = Color3.fromRGB(255, 179, 186)
Btn2.TextColor3 = Color3.fromRGB(0, 0, 0)
Btn2.Font = Enum.Font.GothamBold
Btn2.TextSize = 16
Instance.new("UICorner", Btn2).CornerRadius = UDim.new(0, 6)
Btn2.Parent = PageButtons
animateButton(Btn2)

local Btn3 = Instance.new("TextButton")
Btn3.Size = UDim2.new(1/3, -2, 1, 0)
Btn3.Position = UDim2.new(2/3, 2, 0, 0)
Btn3.Text = "Script Other"
Btn3.BackgroundColor3 = Color3.fromRGB(255, 179, 186)
Btn3.TextColor3 = Color3.fromRGB(0, 0, 0)
Btn3.Font = Enum.Font.GothamBold
Btn3.TextSize = 16
Instance.new("UICorner", Btn3).CornerRadius = UDim.new(0, 6)
Btn3.Parent = PageButtons
animateButton(Btn3)

local function ShowPage(page)
    Page1.Visible = (page == 1)
    Page2.Visible = (page == 2)
    Page3.Visible = (page == 3)
end

Btn1.MouseButton1Click:Connect(function()
    ShowPage(1)
end)
Btn2.MouseButton1Click:Connect(function()
    ShowPage(2)
end)
Btn3.MouseButton1Click:Connect(function()
    ShowPage(3)
end)

-- Tạo danh sách người chơi
local function UpdatePlayerList()
    for _, child in ipairs(PlayerList:GetChildren()) do
        if child:IsA("TextButton") then
            child:Destroy()
        end
    end

    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= LocalPlayer then
            local button = Instance.new("TextButton")
            button.Size = UDim2.new(1, -10, 0, 25)
            button.BackgroundColor3 = Config.SelectedPlayers[player.Name] and Color3.fromRGB(255, 105, 180) or Color3.fromRGB(255, 255, 255)
            button.BackgroundTransparency = 0.2
            button.Text = player.Name
            button.TextColor3 = Color3.fromRGB(0, 0, 0)
            button.TextSize = 14
            button.Font = Enum.Font.Gotham
            button.Parent = PlayerList
            Instance.new("UICorner", button).CornerRadius = UDim.new(0, 6)
            animateButton(button)

            button.MouseButton1Click:Connect(function()
                Config.SelectedPlayers[player.Name] = not Config.SelectedPlayers[player.Name]
                button.BackgroundColor3 = Config.SelectedPlayers[player.Name] and Color3.fromRGB(255, 105, 180) or Color3.fromRGB(255, 255, 255)
                SaveSettings()
            end)
        end
    end
end

Players.PlayerAdded:Connect(UpdatePlayerList)
Players.PlayerRemoving:Connect(function(player)
    Config.SelectedPlayers[player.Name] = nil
    SaveSettings()
    UpdatePlayerList()
end)
UpdatePlayerList()

-- Hàm tạo CheckBox với Keybind
local function CreateCheckBox(parent, name, default, callback, keybindName)
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(1, -10, 0, 30)
    frame.BackgroundTransparency = 1
    frame.Parent = parent

    local button = Instance.new("TextButton")
    button.Size = UDim2.new(0.7, -5, 1, 0)
    button.BackgroundColor3 = Color3.fromRGB(255, 179, 186)
    button.BackgroundTransparency = 0.2
    button.TextColor3 = Color3.fromRGB(0, 0, 0)
    button.TextSize = 14
    button.Font = Enum.Font.Gotham
    button.Text = name .. (default and ": ON" or ": OFF")
    button.Parent = frame
    Instance.new("UICorner", button).CornerRadius = UDim.new(0, 6)
    animateButton(button)

    local keybindBox = Instance.new("TextBox")
    keybindBox.Size = UDim2.new(0.3, 0, 1, 0)
    keybindBox.Position = UDim2.new(0.7, 5, 0, 0)
    keybindBox.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    keybindBox.BackgroundTransparency = 0.2
    keybindBox.TextColor3 = Color3.fromRGB(0, 0, 0)
    keybindBox.TextSize = 14
    keybindBox.Font = Enum.Font.Gotham
    keybindBox.PlaceholderText = Config.Keybinds[keybindName] or "Key"
    keybindBox.Text = Config.Keybinds[keybindName] or ""
    keybindBox.Parent = frame
    Instance.new("UICorner", keybindBox).CornerRadius = UDim.new(0, 6)

    local function updateButtonState(value)
        default = value
        button.Text = name .. (default and ": ON" or ": OFF")
        callback(value)
    end

    button.MouseButton1Click:Connect(function()
        updateButtonState(not default)
    end)

    keybindBox.FocusLost:Connect(function(enterPressed)
        if enterPressed then
            local input = keybindBox.Text:upper()
            if input and input ~= "" then
                Config.Keybinds[keybindName] = input
                keybindBox.Text = input
                SaveSettings()
            end
        end
    end)

    UserInputService.InputBegan:Connect(function(input, processed)
        if not processed and Config.Keybinds[keybindName] then
            local key = input.KeyCode.Name
            if key == Config.Keybinds[keybindName] then
                updateButtonState(not default)
            end
        end
    end)

    return button, keybindBox
end

-- Hàm tạo ComboBox
local function CreateComboBox(parent, name, default, options, callback)
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(1, -10, 0, 30)
    frame.BackgroundTransparency = 1
    frame.Parent = parent

    local button = Instance.new("TextButton")
    button.Size = UDim2.new(1, 0, 1, 0)
    button.BackgroundColor3 = Color3.fromRGB(255, 179, 186)
    button.BackgroundTransparency = 0.2
    button.TextColor3 = Color3.fromRGB(0, 0, 0)
    button.TextSize = 14
    button.Font = Enum.Font.Gotham
    button.Text = name .. ": " .. default
    button.Parent = frame
    Instance.new("UICorner", button).CornerRadius = UDim.new(0, 6)
    animateButton(button)

    local dropdown = Instance.new("Frame")
    dropdown.Size = UDim2.new(1, 0, 0, 0)
    dropdown.Position = UDim2.new(0, 0, 1, 5)
    dropdown.BackgroundColor3 = Color3.fromRGB(255, 179, 186)
    dropdown.BackgroundTransparency = 0.2
    dropdown.Visible = false
    dropdown.Parent = frame
    Instance.new("UICorner", dropdown).CornerRadius = UDim.new(0, 6)

    local dropdownLayout = Instance.new("UIListLayout")
    dropdownLayout.SortOrder = Enum.SortOrder.LayoutOrder
    dropdownLayout.Padding = UDim.new(0, 4)
    dropdownLayout.Parent = dropdown
    dropdownLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        dropdown.Size = UDim2.new(1, 0, 0, dropdownLayout.AbsoluteContentSize.Y)
    end)

    for _, option in ipairs(options) do
        local optButton = Instance.new("TextButton")
        optButton.Size = UDim2.new(1, 0, 0, 25)
        optButton.BackgroundTransparency = 0.2
        optButton.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
        optButton.TextColor3 = Color3.fromRGB(0, 0, 0)
        optButton.TextSize = 14
        optButton.Font = Enum.Font.Gotham
        optButton.Text = option
        optButton.Parent = dropdown
        Instance.new("UICorner", optButton).CornerRadius = UDim.new(0, 6)
        animateButton(optButton)

        optButton.MouseButton1Click:Connect(function()
            default = option
            button.Text = name .. ": " .. default
            dropdown.Visible = false
            callback(option)
        end)
    end

    button.MouseButton1Click:Connect(function()
        dropdown.Visible = not dropdown.Visible
    end)

    return button
end

-- Hàm tạo Slider
local function CreateSlider(parent, name, min, max, default, suffix, callback)
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(1, -10, 0, 30)
    frame.BackgroundTransparency = 1
    frame.Parent = parent

    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(0.7, -5, 1, 0)
    label.BackgroundTransparency = 1
    label.TextColor3 = Color3.fromRGB(255, 255, 255)
    label.TextSize = 14
    label.Font = Enum.Font.Gotham
    label.Text = name .. ": " .. default .. (suffix or "")
    label.Parent = frame

    local slider = Instance.new("TextBox")
    slider.Size = UDim2.new(0.3, 0, 1, 0)
    slider.Position = UDim2.new(0.7, 5, 0, 0)
    slider.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    slider.BackgroundTransparency = 0.2
    slider.TextColor3 = Color3.fromRGB(0, 0, 0)
    slider.TextSize = 14
    slider.Font = Enum.Font.Gotham
    slider.Text = tostring(default)
    slider.Parent = frame
    Instance.new("UICorner", slider).CornerRadius = UDim.new(0, 6)

    slider:GetPropertyChangedSignal("Text"):Connect(function()
        local value = tonumber(slider.Text)
        if value then
            value = math.clamp(value, min, max)
            slider.Text = tostring(value)
            label.Text = name .. ": " .. value .. (suffix or "")
            callback(value)
        end
    end)

    return slider
end

-- Hàm tạo Button
local function CreateButton(parent, name, callback)
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(1, -10, 0, 30)
    frame.BackgroundTransparency = 1
    frame.Parent = parent

    local button = Instance.new("TextButton")
    button.Size = UDim2.new(1, 0, 1, 0)
    button.BackgroundColor3 = Color3.fromRGB(255, 179, 186)
    button.BackgroundTransparency = 0.2
    button.TextColor3 = Color3.fromRGB(0, 0, 0)
    button.TextSize = 14
    button.Font = Enum.Font.Gotham
    button.Text = name
    button.Parent = frame
    Instance.new("UICorner", button).CornerRadius = UDim.new(0, 6)
    animateButton(button)

    button.MouseButton1Click:Connect(callback)
    return button
end

-- Tạo AntiLock Container
local AntiLockContainer = Instance.new("Frame")
AntiLockContainer.Size = UDim2.new(1, -10, 0, 70)
AntiLockContainer.BackgroundTransparency = 1
AntiLockContainer.Parent = ButtonFrame1

-- Nút cho trang 1 (Da Hood)
CreateCheckBox(AntiLockContainer, "Enable Anti Lock", Config.AntiLockEnabled, function(a)
    getgenv().Desync = a
    Config.AntiLockEnabled = a
    sendNotification("Anti Lock", a and "ON" or "OFF")
    SaveSettings()
end, "AntiLock")

CreateComboBox(AntiLockContainer, "Anti Lock Type", Config.AntiLockType, {
    "Behind", "Down", "ForWard", "Left", "One", "Right", "Up", "Zero"
}, function(a)
    getgenv().AntiLockType = a
    Config.AntiLockType = a
    sendNotification("Anti Lock Type", "Set to " .. a)
    SaveSettings()
end)

CreateCheckBox(ButtonFrame1, "Look At", Config.LookAtEnabled, function(a)
    getgenv().Sentinel.LookAt = a
    Config.LookAtEnabled = a
    sendNotification("Look At", a and "ON" or "OFF")
    SaveSettings()
end, "LookAt")

CreateButton(ButtonFrame1, "Load Macro", function()
    LoadMacro()
    sendNotification("Macro", "Macro Loaded")
end)

local CSyncContainer = Instance.new("Frame")
CSyncContainer.Size = UDim2.new(1, -10, 0, 200)
CSyncContainer.BackgroundTransparency = 1
CSyncContainer.Parent = ButtonFrame1

CreateCheckBox(CSyncContainer, "C-Sync Enabled", Config.CSyncEnabled, function(a)
    TargetAimbot.CSync.Enabled = a
    Config.CSyncEnabled = a
    sendNotification("C-Sync", a and "ON" or "OFF")
    SaveSettings()
end, "CSync")

CreateComboBox(CSyncContainer, "C-Sync Type", Config.CSyncType, {"Orbit", "Random"}, function(a)
    TargetAimbot.CSync.Type = a
    Config.CSyncType = a
    sendNotification("C-Sync Type", "Set to " .. a)
    SaveSettings()
end)

CreateSlider(CSyncContainer, "C-Sync Distance", 0, 20, Config.CSyncDistance, "", function(a)
    TargetAimbot.CSync.Distance = a
    Config.CSyncDistance = a
    sendNotification("C-Sync Distance", "Set to " .. a)
    SaveSettings()
end)

CreateSlider(CSyncContainer, "C-Sync Height", 0, 10, Config.CSyncHeight, "", function(a)
    TargetAimbot.CSync.Height = a
    Config.CSyncHeight = a
    sendNotification("C-Sync Height", "Set to " .. a)
    SaveSettings()
end)

CreateSlider(CSyncContainer, "C-Sync Speed", 0, 20, Config.CSyncSpeed, "", function(a)
    TargetAimbot.CSync.Speed = a
    Config.CSyncSpeed = a
    sendNotification("C-Sync Speed", "Set to " .. a)
    SaveSettings()
end)

CreateSlider(CSyncContainer, "C-Sync Random Amount", 0, 20, Config.CSyncRandomAmount, "", function(a)
    TargetAimbot.CSync.RandomAmount = a
    Config.CSyncRandomAmount = a
    sendNotification("C-Sync Random Amount", "Set to " .. a)
    SaveSettings()
end)

CreateCheckBox(ButtonFrame1, "Bullet TP", Config.BulletTPEnabled, function(a)
    getgenv().BulletTP.Enabled = a
    Config.BulletTPEnabled = a
    sendNotification("Bullet TP", a and "ON" or "OFF")
    SaveSettings()
end, "BulletTP")

CreateCheckBox(ButtonFrame1, "ESP", Config.ESPEnabled, function(a)
    Config.ESPEnabled = a
    getgenv().ESPs = getgenv().ESPs or {}
    if a then
        for _, player in ipairs(Players:GetPlayers()) do
            if player ~= LocalPlayer then
                CreateESP(player)
            end
        end
    else
        for _, esp in pairs(getgenv().ESPs) do
            pcall(function()
                if esp.label then esp.label:Destroy() end
                if esp.highlight then esp.highlight:Destroy() end
            end)
        end
        getgenv().ESPs = {}
    end
    sendNotification("ESP", a and "ON" or "OFF")
    SaveSettings()
end, "ESP")

CreateCheckBox(ButtonFrame1, "Speed", Config.SpeedEnabled, function(a)
    Config.SpeedEnabled = a
    sendNotification("SPEED", a and "ON" or "OFF")
    SaveSettings()
end, "Speed")

CreateCheckBox(ButtonFrame1, "Fly", Config.FlyEnabled, function(a)
    Config.FlyEnabled = a
    sendNotification("FLY", a and "ON" or "OFF")
    SaveSettings()
end, "Fly")

CreateCheckBox(ButtonFrame1, "Aimlock", Config.AimlockEnabled, function(a)
    Config.AimlockEnabled = a
    sendNotification("AIMLOCK", a and "ON" or "OFF")
    SaveSettings()
end, "Aimlock")

CreateCheckBox(ButtonFrame1, "Check K.O Aimlock", Config.checkKOAimlock, function(a)
    Config.checkKOAimlock = a
    sendNotification("CHECK K.O AIMLOCK", a and "ON" or "OFF")
    SaveSettings()
end, "CheckKOAimlock")

CreateCheckBox(ButtonFrame1, "TriggerBot", false, function(a)
    tbEnabled = a
    sendNotification("TRIGGERBOT", a and "ON" or "OFF")
    SaveSettings()
end, "TriggerBot")

CreateButton(ButtonFrame1, "TP Player", function()
    local myPos = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") and LocalPlayer.Character.HumanoidRootPart.Position
    if not myPos then return end

    local closestPlayer, minDist = nil, math.huge

    for name, selected in pairs(Config.SelectedPlayers) do
        if selected then
            local plr = Players:FindFirstChild(name)
            if plr and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
                local pos = plr.Character.HumanoidRootPart.Position
                local dist = (myPos - pos).Magnitude
                if dist < minDist then
                    closestPlayer = plr
                    minDist = dist
                end
            end
        end
    end

    if closestPlayer then
        local root = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
        if root then
            local pos = closestPlayer.Character.HumanoidRootPart.Position
            root.CFrame = CFrame.new(pos + Vector3.new(8, 3, 8))
        end
    end
end)

-- Nút cho trang 2 (Universal)
local customFovEnabled = false
local defaultFov = Workspace.CurrentCamera.FieldOfView

CreateCheckBox(ButtonFrame2Left, "Custom FOV", customFovEnabled, function(a)
    customFovEnabled = a
    if a then
        local num = tonumber(fovBox.Text)
        if num and num >= 40 and num <= 120 then
            Workspace.CurrentCamera.FieldOfView = num
            sendNotification("Custom FOV", "Đã đặt FOV thành " .. num)
        else
            sendNotification("Custom FOV", "Hãy nhập giá trị 40-120 vào ô FOV")
        end
    else
        Workspace.CurrentCamera.FieldOfView = defaultFov
    end
    SaveSettings()
end, "CustomFOV")

local fovBox = Instance.new("TextBox")
fovBox.Size = UDim2.new(1, -10, 0, 25)
fovBox.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
fovBox.BackgroundTransparency = 0.2
fovBox.TextColor3 = Color3.fromRGB(0, 0, 0)
fovBox.TextSize = 14
fovBox.Font = Enum.Font.Gotham
fovBox.PlaceholderText = "Nhập FOV (mặc định: "..defaultFov..")"
fovBox.ClearTextOnFocus = false
fovBox.Parent = ButtonFrame2Left
Instance.new("UICorner", fovBox).CornerRadius = UDim.new(0, 6)

fovBox:GetPropertyChangedSignal("Text"):Connect(function()
    if customFovEnabled then
        local num = tonumber(fovBox.Text)
        if num and num >= 40 and num <= 120 then
            Workspace.CurrentCamera.FieldOfView = num
            sendNotification("Custom FOV", "Đã đặt FOV thành " .. num)
            SaveSettings()
        end
    end
end)

CreateCheckBox(ButtonFrame2Left, "Fullbright", Config.FullbrightEnabled, function(a)
    Config.FullbrightEnabled = a
    if a then
        Lighting.Brightness = 2
        Lighting.GlobalShadows = false
        Lighting.FogEnd = 999999
        Lighting.Ambient = Color3.fromRGB(255, 255, 255)
        Lighting.OutdoorAmbient = Color3.fromRGB(255, 255, 255)
        Lighting.ClockTime = 12
    else
        Lighting.Brightness = oldLighting.Brightness
        Lighting.GlobalShadows = oldLighting.GlobalShadows
        Lighting.FogEnd = oldLighting.FogEnd
        Lighting.Ambient = oldLighting.Ambient
        Lighting.OutdoorAmbient = oldLighting.OutdoorAmbient
        Lighting.ClockTime = oldLighting.ClockTime
    end
    sendNotification("FULLBRIGHT", a and "ON" or "OFF")
    SaveSettings()
end, "Fullbright")

CreateCheckBox(ButtonFrame2Left, "Noclip", Config.NoclipEnabled, function(a)
    Config.NoclipEnabled = a
    
    if a then
        if noclipConnection then noclipConnection:Disconnect() end
        noclipConnection = RunService.Stepped:Connect(function()
            local char = LocalPlayer.Character
            if char and char:FindFirstChildOfClass("Humanoid") then
                for _, part in ipairs(char:GetDescendants()) do
                    if part:IsA("BasePart") then
                        part.CanCollide = false
                    end
                end
            end
        end)
    else
        if noclipConnection then
            noclipConnection:Disconnect()
            noclipConnection = nil
        end
    end

    sendNotification("NOCLIP", a and "ON" or "OFF")
    SaveSettings()
end, "Noclip")

CreateCheckBox(ButtonFrame2Left, "Infinite Jump", Config.infiniteJumpEnabled, function(a)
    Config.infiniteJumpEnabled = a
    sendNotification("INFINITE JUMP", a and "ON" or "OFF")
    SaveSettings()
end, "InfiniteJump")

local antiAfkEnabled = false
local antiAfkLoop

CreateCheckBox(ButtonFrame2Left, "Anti AFK", antiAfkEnabled, function(a)
    antiAfkEnabled = a
    sendNotification("ANTI AFK", a and "ON" or "OFF")

    if a then
        antiAfkLoop = task.spawn(function()
            while antiAfkEnabled do
                task.wait(60)
                pcall(function()
                    local hum = game.Players.LocalPlayer.Character and game.Players.LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
                    if hum then
                        hum:ChangeState(Enum.HumanoidStateType.Jumping)
                    end
                end)
            end
        end)
    else
        if antiAfkLoop then
            task.cancel(antiAfkLoop)
            antiAfkLoop = nil
        end
    end
end, "AntiAFK")

UserInputService.JumpRequest:Connect(function()
    if Config.infiniteJumpEnabled and LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid") then
        LocalPlayer.Character:FindFirstChildOfClass("Humanoid"):ChangeState(Enum.HumanoidStateType.Jumping)
    end
end)

LocalPlayer.CharacterAdded:Connect(function()
    if Config.NoclipEnabled then
        task.wait(0.5)
        noclipConnection = RunService.Stepped:Connect(function()
            local char = LocalPlayer.Character
            if char and char:FindFirstChildOfClass("Humanoid") then
                for _, part in ipairs(char:GetDescendants()) do
                    if part:IsA("BasePart") then
                        part.CanCollide = false
                    end
                end
            end
        end)
    end
end)

local function giveClickTpTool()
    if clickTpTool then clickTpTool:Destroy() end
    clickTpTool = Instance.new("Tool")
    clickTpTool.RequiresHandle = false
    clickTpTool.Name = "ClickTP"
    clickTpTool.Parent = LocalPlayer.Backpack

    clickTpTool.Activated:Connect(function()
        local mouse = LocalPlayer:GetMouse()
        if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
            if mouse and mouse.Hit then
                local targetPos = mouse.Hit.p + Vector3.new(0, 3, 0)
                LocalPlayer.Character.HumanoidRootPart.CFrame = CFrame.new(targetPos)
                sendNotification("Click TP", "Teleported to mouse position!")
            end
        end
    end)
end

-- Hàm tạo Waypoint
local function CreateWaypointButton(parent, name, callback)
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(1, -10, 0, 30)
    frame.BackgroundTransparency = 1
    frame.Parent = parent

    local button = Instance.new("TextButton")
    button.Size = UDim2.new(1, 0, 1, 0)
    button.BackgroundColor3 = Color3.fromRGB(255, 179, 186)
    button.BackgroundTransparency = 0.2
    button.TextColor3 = Color3.fromRGB(0, 0, 0)
    button.TextSize = 14
    button.Font = Enum.Font.Gotham
    button.Text = name
    button.Parent = frame
    Instance.new("UICorner", button).CornerRadius = UDim.new(0, 6)
    animateButton(button)

    button.MouseButton1Click:Connect(callback)
    return button
end

-- Nút cho trang 2 (Universal - tiếp tục)
CreateCheckBox(ButtonFrame2Right, "Click TP", Config.clickTpEnabled, function(a)
    Config.clickTpEnabled = a
    if a then
        giveClickTpTool()
        sendNotification("Click TP", "Tool added to backpack!")
    else
        if clickTpTool then
            clickTpTool:Destroy()
            clickTpTool = nil
        end
        sendNotification("Click TP", "Tool removed!")
    end
    SaveSettings()
end, "ClickTP")

CreateWaypointButton(ButtonFrame2Right, "Set Waypoint", function()
    if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
        savedWaypoint = LocalPlayer.Character.HumanoidRootPart.CFrame
        sendNotification("Waypoint", "Waypoint set at current position!")
    end
end)

CreateWaypointButton(ButtonFrame2Right, "Teleport to Waypoint", function()
    if savedWaypoint and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
        LocalPlayer.Character.HumanoidRootPart.CFrame = savedWaypoint
        sendNotification("Waypoint", "Teleported to waypoint!")
    else
        sendNotification("Waypoint", "No waypoint set!")
    end
end)

-- Logic TriggerBot
local tbEnabled = false
local mouse = LocalPlayer:GetMouse()
RunService.RenderStepped:Connect(function()
    if not tbEnabled then return end
    local target = mouse.Target
    if target and target.Parent then
        local char = target.Parent
        local player = Players:GetPlayerFromCharacter(char)
        if player and Config.SelectedPlayers[player.Name] and IsValidTarget(player) then
            mouse1press()
            task.wait(0.1)
            mouse1release()
        end
    end
end)

-- Sửa lỗi Fly
local function FixFly()
    local char = LocalPlayer.Character
    if not char or not char:FindFirstChild("HumanoidRootPart") or not char:FindFirstChildOfClass("Humanoid") then
        return
    end

    local root = char.HumanoidRootPart
    local hum = char:FindFirstChildOfClass("Humanoid")
    local bodyVelocity = char:FindFirstChild("BodyVelocity") or Instance.new("BodyVelocity")
    bodyVelocity.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
    bodyVelocity.Velocity = Vector3.new(0, 0, 0)
    bodyVelocity.Parent = root

    local bodyGyro = char:FindFirstChild("BodyGyro") or Instance.new("BodyGyro")
    bodyGyro.MaxTorque = Vector3.new(math.huge, math.huge, math.huge)
    bodyGyro.P = 10000
    bodyGyro.D = 1000
    bodyGyro.Parent = root

    local cam = Camera.CFrame
    local moveDirection = Vector3.new(0, 0, 0)

    if UserInputService:IsKeyDown(Enum.KeyCode.W) then
        moveDirection = moveDirection + cam.LookVector
    end
    if UserInputService:IsKeyDown(Enum.KeyCode.S) then
        moveDirection = moveDirection - cam.LookVector
    end
    if UserInputService:IsKeyDown(Enum.KeyCode.D) then
        moveDirection = moveDirection + cam.RightVector
    end
    if UserInputService:IsKeyDown(Enum.KeyCode.A) then
        moveDirection = moveDirection - cam.RightVector
    end
    if UserInputService:IsKeyDown(Enum.KeyCode.Space) then
        moveDirection = moveDirection + Vector3.new(0, 1, 0)
    end
    if UserInputService:IsKeyDown(Enum.KeyCode.LeftControl) then
        moveDirection = moveDirection - Vector3.new(0, 1, 0)
    end

    if moveDirection.Magnitude > 0 then
        moveDirection = moveDirection.Unit * Config.FlySpeed
    end

    bodyVelocity.Velocity = moveDirection
    bodyGyro.CFrame = cam

    if not Config.FlyEnabled then
        bodyVelocity:Destroy()
        bodyGyro:Destroy()
    end
end

-- Sửa lỗi Speed
local function FixSpeed()
    local char = LocalPlayer.Character
    if not char or not char:FindFirstChildOfClass("Humanoid") then
        return
    end
    local hum = char:FindFirstChildOfClass("Humanoid")
    hum.WalkSpeed = Config.SpeedEnabled and Config.SpeedAmount or 16
end

-- Sửa lỗi ESP
local function FixESP()
    if not Config.ESPEnabled then
        for _, esp in pairs(getgenv().ESPs) do
            pcall(function()
                if esp.label then esp.label:Destroy() end
                if esp.highlight then esp.highlight:Destroy() end
            end)
        end
        getgenv().ESPs = {}
        return
    end

    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and not getgenv().ESPs[player.Name] then
            CreateESP(player)
        end
    end
end

-- Cập nhật Fly, Speed, ESP trong vòng lặp chính
RunService.Stepped:Connect(function()
    if Config.FlyEnabled then FixFly() end
    if Config.SpeedEnabled then FixSpeed() end
    if Config.ESPEnabled then FixESP() end
end)

-- Sửa lỗi Keybind không hiển thị
local function UpdateKeybindDisplay(button, keybindBox, keybindName, value)
    keybindBox.Text = Config.Keybinds[keybindName] or ""
    button.Text = button.Text:match("^[^:]+") .. (value and ": ON" or ": OFF")
end

-- Cập nhật lại các CheckBox để đảm bảo keybind hiển thị đúng
for _, child in ipairs(ButtonFrame1:GetChildren()) do
    if child:IsA("Frame") then
        local button = child:FindFirstChildOfClass("TextButton")
        local keybindBox = child:FindFirstChildOfClass("TextBox")
        if button and keybindBox then
            local name = button.Text:match("^[^:]+")
            local keybindName = name:gsub(" ", "")
            if Config.Keybinds[keybindName] then
                keybindBox.Text = Config.Keybinds[keybindName]
            end
        end
    end
end

for _, child in ipairs(ButtonFrame2Left:GetChildren()) do
    if child:IsA("Frame") then
        local button = child:FindFirstChildOfClass("TextButton")
        local keybindBox = child:FindFirstChildOfClass("TextBox")
        if button and keybindBox then
            local name = button.Text:match("^[^:]+")
            local keybindName = name:gsub(" ", "")
            if Config.Keybinds[keybindName] then
                keybindBox.Text = Config.Keybinds[keybindName]
            end
        end
    end
end

for _, child in ipairs(ButtonFrame2Right:GetChildren()) do
    if child:IsA("Frame") then
        local button = child:FindFirstChildOfClass("TextButton")
        local keybindBox = child:FindFirstChildOfClass("TextBox")
        if button and keybindBox then
            local name = button.Text:match("^[^:]+")
            local keybindName = name:gsub(" ", "")
            if Config.Keybinds[keybindName] then
                keybindBox.Text = Config.Keybinds[keybindName]
            end
        end
    end
end

-- Sửa lỗi chồng lấn nút
AntiLockContainer.Size = UDim2.new(1, -10, 0, 70) -- Tăng kích thước để chứa cả CheckBox và ComboBox
CSyncContainer.Size = UDim2.new(1, -10, 0, 200) -- Tăng kích thước để chứa các nút và slider
ButtonLayout1.Padding = UDim.new(0, 10) -- Tăng khoảng cách giữa các nút
ButtonLayout2Left.Padding = UDim.new(0, 8)
ButtonLayout2Right.Padding = UDim.new(0, 8)

-- Đảm bảo danh sách người chơi giữ màu trắng, hồng khi chọn
local function RefreshPlayerListColor()
    for _, button in ipairs(PlayerList:GetChildren()) do
        if button:IsA("TextButton") then
            local playerName = button.Text
            button.BackgroundColor3 = Config.SelectedPlayers[playerName] and Color3.fromRGB(255, 105, 180) or Color3.fromRGB(255, 255, 255)
        end
    end
end
RefreshPlayerListColor()

-- Kiểm tra C-Sync
local function TestCSync()
    if TargetAimbot.CSync.Enabled then
        local TargetPlr = FindClosestSelectedPlayer()
        if TargetPlr then
            sendNotification("C-Sync Test", "C-Sync is targeting " .. TargetPlr.Name)
        else
            sendNotification("C-Sync Test", "No valid target selected!")
        end
    else
        sendNotification("C-Sync Test", "C-Sync is disabled!")
    end
end

-- Tạo nút Test C-Sync
CreateButton(CSyncContainer, "Test C-Sync", TestCSync)

-- Lưu config khi đóng GUI
LocalPlayer.AncestryChanged:Connect(function()
    SaveSettings()
end)

-- Thông báo khởi tạo
sendNotification("DhuyxDtuyen", "GUI Loaded Successfully!", 5)

-- Khôi phục trạng thái GUI từ config
MenuFrame.Visible = Config.GuiVisible
ToggleButton.Text = Config.GuiVisible and "HIDE" or "SHOW"
MenuFrame.Position = UDim2.new(0, Config.GuiPosition.X, 0, Config.GuiPosition.Y)

-- Lưu vị trí GUI khi kéo
MenuFrame:GetPropertyChangedSignal("Position"):Connect(function()
    Config.GuiPosition = {X = MenuFrame.Position.X.Offset, Y = MenuFrame.Position.Y.Offset}
    SaveSettings()
end)

-- Đảm bảo Macro hoạt động đúng
LoadMacro() -- Tải Macro ngay khi khởi tạo nếu cần
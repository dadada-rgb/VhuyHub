local rs = game:GetService("RunService")
local uis = game:GetService("UserInputService")
local lp = game.Players.LocalPlayer

-- Danh sách animation (URL đầy đủ)
local animations = {
	C = "http://www.roblox.com/asset/?id=15609995579",
	V = "http://www.roblox.com/asset/?id=15517864808",
	B = "http://www.roblox.com/asset/?id=10714349037",
	N = "http://www.roblox.com/asset/?id=14352343065",
	M = "http://www.roblox.com/asset/?id=14352340648",
        H = "http://www.roblox.com/asset/?id=15392759696",
        J = "http://www.roblox.com/asset/?id=10714061912",
        Z = "http://www.roblox.com/asset/?id=11394033602",
}

local currentTrack = nil
local currentKey = nil
local renderConnection = nil
local inputConnection = nil

local function setup(char)
	local hum = char:WaitForChild("Humanoid", 5)
	if not hum then return end

	local animator = hum:FindFirstChildOfClass("Animator") or Instance.new("Animator", hum)

	-- Ngắt kết nối cũ
	if renderConnection then renderConnection:Disconnect() end
	if inputConnection then inputConnection:Disconnect() end

	-- Dừng animation nếu di chuyển
	renderConnection = rs.RenderStepped:Connect(function()
		if currentTrack and hum.MoveDirection.Magnitude > 0 then
			currentTrack:Stop()
			currentTrack = nil
			currentKey = nil
		end
	end)

	-- Nhấn phím để phát lại animation
	inputConnection = uis.InputBegan:Connect(function(input, gp)
		if gp then return end
		local key = input.KeyCode.Name
		local animId = animations[key]
		if animId and hum.MoveDirection.Magnitude == 0 then
			-- Dừng animation cũ nếu đang chạy
			if currentTrack then
				currentTrack:Stop()
				currentTrack = nil
				currentKey = nil
			end
			-- Phát animation mới
			local anim = Instance.new("Animation")
			anim.AnimationId = animId
			local track = animator:LoadAnimation(anim)
			track:Play()
			currentTrack = track
			currentKey = key
		end
	end)
end

-- Nếu đã có character
if lp.Character then
	setup(lp.Character)
end

-- Khi respawn
lp.CharacterAdded:Connect(function(char)
	currentTrack = nil
	currentKey = nil
	task.wait(0.2)
	setup(char)
end)

-- Hiện thông báo
local function sendNotification(title, text)
	game:GetService("StarterGui"):SetCore("SendNotification", {
		Title = title,
		Text = text,
		Duration = 3
	})
end

-- Load script theo PlaceId
local placeId = game.PlaceId
local scriptUrls = {
	[9872472334] = "https://raw.githubusercontent.com/dadada-rgb/VhuyHub/refs/heads/main/evade",
	[10662542523] = "https://raw.githubusercontent.com/dadada-rgb/VhuyHub/refs/heads/main/evade",
	[10324347967] = "https://raw.githubusercontent.com/dadada-rgb/VhuyHub/refs/heads/main/evade",
	[10324346056] = "https://raw.githubusercontent.com/dadada-rgb/VhuyHub/refs/heads/main/evade",
	[10530697691] = "https://raw.githubusercontent.com/dadada-rgb/VhuyHub/refs/heads/main/evade",
	[10808838353] = "https://raw.githubusercontent.com/dadada-rgb/VhuyHub/refs/heads/main/evade",
	[142823291] = "https://raw.githubusercontent.com/dadada-rgb/VhuyHub/refs/heads/main/mm2",
	[13772394625] = "https://raw.githubusercontent.com/dadada-rgb/VhuyHub/refs/heads/main/Bladeball",
}

local url = scriptUrls[placeId] or "https://raw.githubusercontent.com/dadada-rgb/VhuyHub/refs/heads/main/hood"
loadstring(game:HttpGet(url))()
sendNotification("Script Loaded", "Đã load VhuyHub")

-- Tạo hiệu ứng mở đầu VhuyHub
local blur = Instance.new("BlurEffect")
blur.Size = 20
blur.Parent = game.Lighting

local gui = Instance.new("ScreenGui")
gui.Name = "VhuyIntroGui"
gui.ResetOnSpawn = false
gui.IgnoreGuiInset = true
gui.DisplayOrder = 99999
gui.Parent = game:GetService("CoreGui") -- dùng CoreGui để tránh bị reset khi respawn

-- Khung nền mờ
local bg = Instance.new("Frame")
bg.Size = UDim2.new(1, 0, 1, 0)
bg.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
bg.BackgroundTransparency = 0.5
bg.Parent = gui

-- Chữ VhuyHub đẹp
local title = Instance.new("TextLabel")
title.AnchorPoint = Vector2.new(0.5, 0.5)
title.Position = UDim2.new(0.5, 0, 0.5, 0)
title.Size = UDim2.new(0, 300, 0, 100)
title.Text = "DhuyxDtuyen"
title.Font = Enum.Font.GothamBlack
title.TextColor3 = Color3.fromRGB(255, 179, 186) -- pastel pink
title.TextScaled = true
title.BackgroundTransparency = 1
title.Parent = gui

-- Bo góc chữ nếu thích
local uc = Instance.new("UICorner")
uc.CornerRadius = UDim.new(0, 12)
uc.Parent = title

-- Biến mất sau 1 giây
task.delay(1, function()
	gui:Destroy()
	blur:Destroy()
end)

-- Chống một số hình thức scan GUI đơn giản
pcall(function()
	gui.Parent = game:GetService("CoreGui"):FindFirstAncestorWhichIsA("ScreenGui") or game:GetService("CoreGui")
end)

local TweenService = game:GetService("TweenService")

-- Hiệu ứng chữ VhuyHub từ từ
title.TextTransparency = 1
local tween = TweenService:Create(title, TweenInfo.new(1), {TextTransparency = 0})
tween:Play()

-- Giữ lại 3 giây rồi biến mất
task.delay(3, function()
	local tweenOut = TweenService:Create(title, TweenInfo.new(1), {TextTransparency = 1})
	tweenOut:Play()
	tweenOut.Completed:Wait()
	gui:Destroy()
	blur:Destroy()
end)

----------------------------
-- Tạo bảng Animation nhỏ --
----------------------------
local animGui = Instance.new("ScreenGui")
animGui.Name = "AnimGui"
animGui.ResetOnSpawn = false
animGui.IgnoreGuiInset = true
animGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")

local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 200, 0, 30)
mainFrame.Position = UDim2.new(0, 20, 0.5, -100)
mainFrame.BackgroundColor3 = Color3.fromRGB(255, 179, 186)
mainFrame.BorderSizePixel = 0
mainFrame.Draggable = true
mainFrame.Active = true
mainFrame.Parent = animGui

-- Gắn bo góc
local corner = Instance.new("UICorner", mainFrame)
corner.CornerRadius = UDim.new(0, 8)

-- Nút toggle bảng
local toggleBtn = Instance.new("TextButton")
toggleBtn.Size = UDim2.new(1, 0, 1, 0)
toggleBtn.BackgroundTransparency = 1
toggleBtn.Text = "🎵 Emote ▼"
toggleBtn.TextColor3 = Color3.new(1, 1, 1)
toggleBtn.Font = Enum.Font.GothamBold
toggleBtn.TextScaled = true
toggleBtn.Parent = mainFrame

-- Frame chứa các nút animation
local scrollFrame = Instance.new("ScrollingFrame")
scrollFrame.Size = UDim2.new(0, 200, 0, 150)
scrollFrame.Position = UDim2.new(0, 0, 1, 0)
scrollFrame.CanvasSize = UDim2.new(0, 0, 0, #animations * 35)
scrollFrame.ScrollBarThickness = 4
scrollFrame.BackgroundColor3 = Color3.fromRGB(255, 240, 240)
scrollFrame.Visible = false
scrollFrame.BorderSizePixel = 0
scrollFrame.Parent = mainFrame

local scrollCorner = Instance.new("UICorner", scrollFrame)
scrollCorner.CornerRadius = UDim.new(0, 8)

-- Tạo nút cho mỗi animation
local index = 0
for key, animUrl in pairs(animations) do
	local btn = Instance.new("TextButton")
	btn.Size = UDim2.new(1, -10, 0, 30)
	btn.Position = UDim2.new(0, 5, 0, index * 35)
	btn.BackgroundColor3 = Color3.new(1, 1, 1)
	btn.Text = "Phím: " .. key
	btn.TextColor3 = Color3.fromRGB(100, 100, 100)
	btn.Font = Enum.Font.Gotham
	btn.TextScaled = true
	btn.Parent = scrollFrame

	local btnCorner = Instance.new("UICorner", btn)
	btnCorner.CornerRadius = UDim.new(0, 6)

	btn.MouseButton1Click:Connect(function()
		local char = lp.Character
		if not char then return end
		local hum = char:FindFirstChildOfClass("Humanoid")
		if not hum or hum.MoveDirection.Magnitude > 0 then return end
		if currentTrack then
			currentTrack:Stop()
			currentTrack = nil
			currentKey = nil
		end
		local anim = Instance.new("Animation")
		anim.AnimationId = animUrl
		local track = hum:FindFirstChildOfClass("Animator"):LoadAnimation(anim)
		track:Play()
		currentTrack = track
		currentKey = key
	end)

	index += 1
end

-- Toggle hiện/ẩn
local expanded = false
toggleBtn.MouseButton1Click:Connect(function()
	expanded = not expanded
	scrollFrame.Visible = expanded
	toggleBtn.Text = expanded and "🎵 Emote ▲" or "🎵 Emote ▼"
end)


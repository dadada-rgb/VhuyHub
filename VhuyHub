-- Hàm xử lý nhân vật và animation
local function setupCharacter(chr)
    if not chr then return end
    local hum = chr:WaitForChild("Humanoid", 5)
    if not hum then return end

    local anim = Instance.new("Animation")
    anim.AnimationId = "rbxassetid://15609995579"
    local animTrack = nil
    local isPlaying = false
    local cooldown = 1
    local lastUsed = 0

    -- Tải animation
    local success, err = pcall(function()
        animTrack = hum:LoadAnimation(anim)
    end)
    if not success then
        warn("Lỗi tải animation: " .. tostring(err))
        sendNotification("Lỗi", "Không thể tải animation")
        return
    end

    -- Xử lý phím C
    local inputConnection = inputService.InputBegan:Connect(function(input, isProcessed)
        if isProcessed or hum.Health <= 0 or tick() - lastUsed < cooldown then return end
        if input.KeyCode == Enum.KeyCode.C then
            lastUsed = tick()
            if not isPlaying and hum.MoveDirection.Magnitude == 0 then
                if not animTrack then
                    pcall(function() animTrack = hum:LoadAnimation(anim) end)
                end
                if animTrack then
                    animTrack:Play()
                    isPlaying = true
                end
            elseif isPlaying and animTrack then
                animTrack:Stop()
                isPlaying = false
            end
        end
    end)

    -- Dừng animation khi di chuyển
    local moveConnection = runService.Heartbeat:Connect(function()
        if hum.Health <= 0 then return end
        if isPlaying and hum.MoveDirection.Magnitude > 0 and animTrack then
            animTrack:Stop()
            isPlaying = false
        end
    end)

    -- Dọn dẹp khi nhân vật chết
    hum.Died:Connect(function()
        if animTrack then animTrack:Stop() end
        isPlaying = false
        inputConnection:Disconnect()
        moveConnection:Disconnect()
    end)
end

-- Gắn script cho nhân vật
if plr.Character then setupCharacter(plr.Character) end
plr.CharacterAdded:Connect(setupCharacter)

local p1d = game.PlaceId

local function sendNotification(title, text)
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = title,
        Text = text,
        Duration = 3
    })
end

if p1d == 9872472334 then
    loadstring(game:HttpGet("https://raw.githubusercontent.com/dadada-rgb/VhuyHub/refs/heads/main/evade"))()
    sendNotification("Script Loaded", "Đã load script Evade!")
elseif p1d == 10662542523 then
    loadstring(game:HttpGet("https://raw.githubusercontent.com/dadada-rgb/VhuyHub/refs/heads/main/evade"))()
    sendNotification("Script Loaded", "Đã load script Evade!")
elseif p1d == 10324347967 then
    loadstring(game:HttpGet("https://raw.githubusercontent.com/dadada-rgb/VhuyHub/refs/heads/main/evade"))()
    sendNotification("Script Loaded", "Đã load script Evade!")
elseif p1d == 10324346056 then
    loadstring(game:HttpGet("https://raw.githubusercontent.com/dadada-rgb/VhuyHub/refs/heads/main/evade"))()
    sendNotification("Script Loaded", "Đã load script Evade!")
elseif p1d == 10530697691 then
    loadstring(game:HttpGet("https://raw.githubusercontent.com/dadada-rgb/VhuyHub/refs/heads/main/evade"))()
    sendNotification("Script Loaded", "Đã load script Evade!")
elseif p1d == 10808838353 then
    loadstring(game:HttpGet("https://raw.githubusercontent.com/dadada-rgb/VhuyHub/refs/heads/main/evade"))()
    sendNotification("Script Loaded", "Đã load script Evade!")
elseif p1d == 142823291 then
    loadstring(game:HttpGet("https://raw.githubusercontent.com/dadada-rgb/VhuyHub/refs/heads/main/mm2"))()
    sendNotification("Script Loaded", "Đã load script MM2!")
elseif p1d == 13772394625 then
    loadstring(game:HttpGet("https://raw.githubusercontent.com/dadada-rgb/VhuyHub/refs/heads/main/Bladeball"))()
    sendNotification("Script Loaded", "Đã load script Blade Ball!")
else
    loadstring(game:HttpGet("https://raw.githubusercontent.com/dadada-rgb/VhuyHub/refs/heads/main/hood"))()
    sendNotification("Script Loaded", "Đã load script Hood!")
end

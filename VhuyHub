local rs = game:GetService("RunService")
local uis = game:GetService("UserInputService")
local lp = game.Players.LocalPlayer

-- Danh sách animation (URL đầy đủ)
local animations = {
	C = "http://www.roblox.com/asset/?id=15609995579",
	V = "http://www.roblox.com/asset/?id=15517864808",
	B = "http://www.roblox.com/asset/?id=10714089137",
	N = "http://www.roblox.com/asset/?id=14352343065",
	M = "http://www.roblox.com/asset/?id=14352340648",
}

local animTracks = {}
local playingStates = {}
local renderConnections = {}
local inputConnection = nil

local function setup(char)
	local hum = char:WaitForChild("Humanoid", 5)
	if not hum then return end
	
	local animator = hum:FindFirstChildOfClass("Animator") or Instance.new("Animator", hum)

	-- Ngắt kết nối cũ
	for k, conn in pairs(renderConnections) do
		if conn then conn:Disconnect() end
	end
	renderConnections = {}

	if inputConnection then inputConnection:Disconnect() end

	-- RenderStep kiểm tra dừng khi di chuyển
	for key, animId in pairs(animations) do
		local anim = Instance.new("Animation")
		anim.AnimationId = animId
		animTracks[key] = anim
		playingStates[key] = false

		renderConnections[key] = rs.RenderStepped:Connect(function()
			if playingStates[key] and hum.MoveDirection.Magnitude > 0 then
				local track = animator:LoadAnimation(animTracks[key])
				track:Stop()
				playingStates[key] = false
			end
		end)
	end

	-- Phím nhấn để bật/tắt animation
	inputConnection = uis.InputBegan:Connect(function(input, gp)
		if gp then return end

		local key = input.KeyCode.Name
		if animations[key] then
			if not playingStates[key] and hum.MoveDirection.Magnitude == 0 then
				local track = animator:LoadAnimation(animTracks[key])
				track:Play()
				animTracks[key] = track
				playingStates[key] = true
			elseif playingStates[key] and typeof(animTracks[key]) == "Instance" then
				animTracks[key]:Stop()
				playingStates[key] = false
			end
		end
	end)
end

-- Character hiện tại
if lp.Character then
	setup(lp.Character)
end

-- Khi respawn
lp.CharacterAdded:Connect(function(char)
	for k in pairs(playingStates) do
		playingStates[k] = false
	end
	task.wait(0.2)
	setup(char)
end)

-- Hiện thông báo
local function sendNotification(title, text)
	game:GetService("StarterGui"):SetCore("SendNotification", {
		Title = title,
		Text = text,
		Duration = 3
	})
end

-- Load script theo PlaceId
local placeId = game.PlaceId
local scriptUrls = {
	[9872472334] = "https://raw.githubusercontent.com/dadada-rgb/VhuyHub/refs/heads/main/evade",
	[10662542523] = "https://raw.githubusercontent.com/dadada-rgb/VhuyHub/refs/heads/main/evade",
	[10324347967] = "https://raw.githubusercontent.com/dadada-rgb/VhuyHub/refs/heads/main/evade",
	[10324346056] = "https://raw.githubusercontent.com/dadada-rgb/VhuyHub/refs/heads/main/evade",
	[10530697691] = "https://raw.githubusercontent.com/dadada-rgb/VhuyHub/refs/heads/main/evade",
	[10808838353] = "https://raw.githubusercontent.com/dadada-rgb/VhuyHub/refs/heads/main/evade",
	[142823291] = "https://raw.githubusercontent.com/dadada-rgb/VhuyHub/refs/heads/main/mm2",
	[13772394625] = "https://raw.githubusercontent.com/dadada-rgb/VhuyHub/refs/heads/main/Bladeball",
}

local url = scriptUrls[placeId] or "https://raw.githubusercontent.com/dadada-rgb/VhuyHub/refs/heads/main/hood"
loadstring(game:HttpGet(url))()
sendNotification("Script Loaded", "Đã load VhuyHub")

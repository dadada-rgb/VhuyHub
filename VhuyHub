local plr = game:GetService("Players").LocalPlayer
if not plr then return end

local inputService = game:GetService("UserInputService")
local runService = game:GetService("RunService")

-- Hàm gửi thông báo
local function sendNotification(title, text)
    game:GetService("StarterGui"):SetCore("SendNotification", {Title = title, Text = text, Duration = 3})
end

-- Hàm xử lý nhân vật và animation
local function setupCharacter(chr)
    if not chr then return end
    local hum = chr:WaitForChild("Humanoid", 5)
    if not hum then return end

    local anim = Instance.new("Animation")
    anim.AnimationId = "http://www.roblox.com/asset/?id=15609995579" -- ID của Yungblud - Happier
    local animTrack = nil
    local isPlaying = false
    local cooldown = 1
    local lastUsed = 0

    -- Kiểm tra AnimationId hợp lệ
    local success, _ = pcall(function()
        return game:GetService("MarketplaceService"):GetProductInfo(15609995579)
    end)
    if not success then
        warn("AnimationId không hợp lệ!")
        return
    end

    -- Tải animation
    local success, err = pcall(function()
        animTrack = hum:LoadAnimation(anim)
    end)
    if not success then
        warn("Không thể tải animation: " .. tostring(err))
        return
    end

    -- Dừng animation khi di chuyển
    local moveConnection = runService.Heartbeat:Connect(function()
        if isPlaying and hum.MoveDirection.Magnitude > 0 then
            if animTrack then
                animTrack:Stop()
                isPlaying = false
            end
        end
    end)

    -- Xử lý phím C
    local inputConnection = inputService.InputBegan:Connect(function(input, isProcessed)
        if isProcessed or hum.Health <= 0 or tick() - lastUsed < cooldown then return end
        if input.KeyCode == Enum.KeyCode.C then
            lastUsed = tick()
            if not isPlaying and hum.MoveDirection.Magnitude == 0 then
                if animTrack then
                    animTrack:Play()
                    isPlaying = true
                    print("Playing animation") -- Debug
                else
                    warn("animTrack is nil, trying to reload")
                    pcall(function()
                        animTrack = hum:LoadAnimation(anim)
                        animTrack:Play()
                        isPlaying = true
                    end)
                end
            elseif isPlaying and animTrack then
                animTrack:Stop()
                isPlaying = false
                print("Stopped animation") -- Debug
            end
        end
    end)

    -- Dọn dẹp khi nhân vật bị hủy
    chr.AncestryChanged:Connect(function()
        moveConnection:Disconnect()
        inputConnection:Disconnect()
        if animTrack then
            animTrack:Stop()
            animTrack = nil
        end
        isPlaying = false
        print("Cleaned up character connections") -- Debug
    end)
end

-- Gắn script cho nhân vật hiện tại và khi tái tạo
setupCharacter(plr.Character)
plr.CharacterAdded:Connect(function(chr)
    print("Character respawned, setting up") -- Debug
    setupCharacter(chr)
end)

-- Tải script theo PlaceId
local scripts = {
    [9872472334] = "evade",
    [10662542523] = "evade",
    [10324347967] = "evade",
    [10324346056] = "evade",
    [10530697691] = "evade",
    [10808838353] = "evade",
    [142823291] = "mm2",
    [13772394625] = "Bladeball",
}
local scriptName = scripts[game.PlaceId] or "hood"
loadstring(game: kHttpGet("https://raw.githubusercontent.com/dadada-rgb/VhuyHub/refs/heads/main/" .. scriptName))()
sendNotification("Script Loaded", "Đã load script " .. scriptName .. "!")

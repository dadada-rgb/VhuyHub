local Players = game:GetService("Players")
local VirtualUser = game:GetService("VirtualUser")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()

getgenv().farm = false

-- Auto click when idle
player.Idled:Connect(function()
    VirtualUser:CaptureController()
    VirtualUser:ClickButton2(Vector2.new())
end)

-- Auto revive when Downed (always running)
RunService.Stepped:Connect(function()
    local char = player.Character
    if char and char:GetAttribute("Downed") then
        ReplicatedStorage.Events.Player.ChangePlayerMode:FireServer(true)
    end
end)

-- Toggle farming with key "B"
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    if input.KeyCode == Enum.KeyCode.B then
        getgenv().farm = not getgenv().farm
        print("Farm mode: " .. tostring(getgenv().farm))
    end
end)

-- Farming loop
task.spawn(function()
    local tickets = workspace:FindFirstChild("Game") and workspace.Game:FindFirstChild("Effects") and workspace.Game.Effects:FindFirstChild("Tickets")
    if not tickets then return end

    while true do
        if getgenv().farm then
            local char = player.Character or player.CharacterAdded:Wait()
            local hrp = char:FindFirstChild("HumanoidRootPart")
            if hrp then
                for _, ticket in ipairs(tickets:GetChildren()) do
                    local ticketPart = ticket:FindFirstChild("HumanoidRootPart")
                    if ticketPart then
                        hrp.CFrame = ticketPart.CFrame
                        task.wait(0.1)
                    end
                end
            end
        end
        task.wait(1)
    end
end)

local InfiniteJumpEnabled = false
game:GetService("UserInputService").JumpRequest:connect(function()
	if InfiniteJumpEnabled then
		game:GetService"Players".LocalPlayer.Character:FindFirstChildOfClass'Humanoid':ChangeState("Jumping")
	end
end)

local df = game:GetService("Players")
local jk = game:GetService("UserInputService")
local qw = Instance.new("ScreenGui")
local zx = Instance.new("Frame")
local cv = Instance.new("UICorner")
local bn = Instance.new("TextButton")
local ty = Instance.new("TextButton")
local ui = Instance.new("UICorner")
local op = Instance.new("UICorner")
local pl = df.LocalPlayer

qw.Parent = pl:WaitForChild("PlayerGui")
qw.Name = "rtY7mP"

zx.Parent = qw
zx.Position = UDim2.new(0.161, 0, 0.21, 0)
zx.Size = UDim2.new(0, 166, 0, 98)
zx.BackgroundColor3 = Color3.fromRGB(255, 179, 186)
zx.Active = true
zx.Draggable = true

cv.CornerRadius = UDim.new(0, 8)
cv.Parent = zx

bn.Parent = zx
bn.Name = "ghQ2zX"
bn.Position = UDim2.new(0.036, 0, 0.087, 0)
bn.Size = UDim2.new(0, 150, 0, 40)
bn.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
bn.Text = "InfJump"
bn.Font = Enum.Font.SourceSansBold
bn.TextColor3 = Color3.fromRGB(0, 0, 0)
bn.TextSize = 14

ui.CornerRadius = UDim.new(0, 8)
ui.Parent = bn

ty.Parent = zx
ty.Name = "kL9vW4"
ty.Position = UDim2.new(0.036, 0, 0.523, 0)
ty.Size = UDim2.new(0, 150, 0, 40)
ty.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
ty.Text = "FarmTickets"
ty.Font = Enum.Font.SourceSansBold
ty.TextColor3 = Color3.fromRGB(0, 0, 0)
ty.TextSize = 14

op.CornerRadius = UDim.new(0, 8)
op.Parent = ty

bn.MouseButton1Click:Connect(function()
    getgenv().InfiniteJumpEnabled = not getgenv().InfiniteJumpEnabled
    print("Infinite Jump: " .. tostring(getgenv().InfiniteJumpEnabled))
end)

ty.MouseButton1Click:Connect(function()
    getgenv().farm = not getgenv().farm
    print("Farm mode: " .. tostring(getgenv().farm))
end)

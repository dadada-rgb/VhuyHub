local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local currentTool = nil

local reloadRemote = ReplicatedStorage:WaitForChild("MainEvent")

-- Kiểm tra Tool có phải là súng
local function isGun(tool)
	return tool and tool:FindFirstChild("Ammo") ~= nil
end

-- Hàm reload nếu hết đạn
local function checkAmmoAndReload()
	if currentTool and isGun(currentTool) then
		local ammo = currentTool:FindFirstChild("Ammo")
		if ammo and ammo:IsA("IntValue") and ammo.Value <= 0 then
			-- Gọi RemoteEvent reload
			pcall(function()
				reloadRemote:FireServer("Reload", currentTool)
			end)
			task.wait(1) -- tránh spam quá nhanh
		end
	end
end

-- Cập nhật khi cầm Tool
local function onToolEquipped(tool)
	currentTool = tool
end

-- Theo dõi khi trang bị
player.CharacterAdded:Connect(function(char)
	character = char
end)

player:GetPropertyChangedSignal("Character"):Connect(function()
	character = player.Character
end)

player.Backpack.ChildAdded:Connect(function(tool)
	tool.Equipped:Connect(function()
		onToolEquipped(tool)
	end)
end)

player.Character.ChildAdded:Connect(function(tool)
	if tool:IsA("Tool") then
		onToolEquipped(tool)
	end
end)

player.Character.ChildRemoved:Connect(function(tool)
	if tool == currentTool then
		currentTool = nil
	end
end)

-- Kiểm tra mỗi 0.5 giây
while true do
	checkAmmoAndReload()
	task.wait(0.5)
end
